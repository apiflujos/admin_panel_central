<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ApiFlujos - Alegra Integraciones</title>
    <link rel="icon" type="image/png" href="/favicon.png?v=20260205a" />
    <link rel="stylesheet" href="styles.css?v=20260210p14" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <div class="sidebar-header">
          <button class="ghost sidebar-toggle" id="sidebar-toggle" aria-label="Abrir/cerrar menu" title="Menú">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path id="sidebar-toggle-icon" d="M15 18l-6-6 6-6" />
              </svg>
            </span>
            <span class="sidebar-toggle-label">Menú</span>
          </button>
        </div>
        <nav class="nav">
          <button class="nav-item is-active" data-target="dashboard" title="Metricas">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M4 20V10M10 20V4M16 20v-7M22 20H2" />
              </svg>
            </span>
            <span class="nav-label">Metricas</span>
          </button>
	          <button class="nav-item" data-target="operations" data-ops-view="orders" title="Pedidos">
	            <span class="nav-icon" aria-hidden="true">
	              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
	                <path d="M7 8h10M7 12h10M7 16h6" />
	                <path d="M6 4h12a2 2 0 0 1 2 2v12l-3-2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
	              </svg>
	            </span>
	            <span class="nav-label">Pedidos</span>
	          </button>
			          <button class="nav-item" data-target="operations" data-ops-view="invoices" title="Facturas">
		            <span class="nav-icon" aria-hidden="true">
		              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
		                <path d="M7 8h10M7 12h10M7 16h10" />
		                <path d="M6 4h12a2 2 0 0 1 2 2v14l-2-1-2 1-2-1-2 1-2-1-2 1-2-1-2 1V6a2 2 0 0 1 2-2z" />
		              </svg>
		            </span>
		            <span class="nav-label">Facturas</span>
		          </button>
          <button class="nav-item" data-target="contacts" title="Contactos">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M16 11a4 4 0 1 1-8 0 4 4 0 0 1 8 0z" />
                <path d="M4 20a8 8 0 0 1 16 0" />
              </svg>
            </span>
            <span class="nav-label">Contactos</span>
          </button>
          <button class="nav-item" data-target="products" title="Productos">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M3 7h18v13H3z" />
                <path d="M7 7l5-4 5 4" />
              </svg>
            </span>
            <span class="nav-label">Productos</span>
          </button>
          <button class="nav-item" data-target="marketing" title="Marketing">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M3 11l18-5-5 18-3-8-8-3z" />
                <path d="M13 16l4-4" />
              </svg>
            </span>
            <span class="nav-label">Marketing</span>
          </button>
	          <button class="nav-item" data-target="settings" title="Configuracion">
	            <span class="nav-icon" aria-hidden="true">
	              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
	                <circle cx="12" cy="12" r="3.2" />
	                <path d="M19.4 15a7.5 7.5 0 0 0 0-6l2-1.2-2-3.4-2.3 1a7.4 7.4 0 0 0-5.2-2.2L11 1H7l-.6 2.2a7.4 7.4 0 0 0-5.2 2.2l-2.3-1-2 3.4 2 1.2a7.5 7.5 0 0 0 0 6l-2 1.2 2 3.4 2.3-1a7.4 7.4 0 0 0 5.2 2.2L7 23h4l.6-2.2a7.4 7.4 0 0 0 5.2-2.2l2.3 1 2-3.4-2-1.2z" />
	              </svg>
	            </span>
	            <span class="nav-label">Configuracion</span>
	          </button>


          <div class="nav-spacer" aria-hidden="true"></div>

          <button class="nav-item" data-target="superadmin" title="Super Admin" id="nav-superadmin" style="display:none">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M12 3l7 4v6c0 5-3 8-7 8s-7-3-7-8V7l7-4z" />
                <path d="M9 12l2 2 4-4" />
              </svg>
            </span>
            <span class="nav-label">Super Admin</span>
          </button>

          <button class="nav-item" data-target="logs" title="Logs de API">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M5 4h10l4 4v12H5z" />
                <path d="M8 12h8M8 16h8M8 8h4" />
              </svg>
            </span>
            <span class="nav-label">Logs de API</span>
          </button>
	        </nav>
	        <div class="sidebar-footer">
            <button class="nav-item nav-logout" id="sidebar-logout" type="button" title="Salir">
              <span class="nav-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                  <path d="M16 17l5-5-5-5" />
                  <path d="M21 12H9" />
                </svg>
              </span>
              <span class="nav-label">Salir</span>
            </button>
          </div>
	      </aside>

      <main class="content">
        <header class="topbar">
          <div class="topbar-left">
            <div class="topbar-brand apiflujos-brand">
              <img id="company-logo" src="/assets/logo.png" alt="ApiFlujos" />
            </div>
          </div>
          <div class="topbar-actions">
	            <div class="topbar-billing" id="topbar-billing" style="display:none">
	              <span class="status-pill" id="billing-plan-pill">--</span>
	              <span class="status-pill" id="billing-month-metrics">Consumo: -- · Cobro: --</span>
	            </div>
            <div class="topbar-user" id="topbar-user">
              <button class="ghost topbar-user-trigger" id="topbar-user-toggle" type="button">
                <img id="user-avatar" src="/assets/avatar.png" alt="Usuario" />
                <div class="topbar-user-meta">
                  <span id="user-name">--</span>
                  <span id="user-role">Agente</span>
                </div>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </button>
              <div class="topbar-user-menu" id="topbar-user-menu">
                <button class="ghost" data-user-action="profile">Perfil usuario</button>
                <button class="ghost admin-only" data-user-action="company">Perfil empresa</button>
                <button class="ghost admin-only" data-user-action="users">Usuarios</button>
                <button class="ghost" data-user-action="logout">Cerrar sesion</button>
              </div>
            </div>
          </div>
        </header>
        <div class="sync-progress" id="sync-progress" aria-hidden="true">
          <div class="sync-progress-track">
            <div class="sync-progress-bar" id="sync-progress-bar"></div>
          </div>
          <span class="sync-progress-label" id="sync-progress-label">Sincronizando 0%</span>
        </div>

        <section class="section is-active" id="dashboard">
          <div class="metrics-layout">
            <div class="metrics-right">
              <div class="metrics-hero">
                <div>
                  <p class="metrics-kicker">Metricas</p>
                  <h2>Panorama operativo Olivia Shoes</h2>
                  <p class="metrics-sub">Ventas, pedidos y actividad de sincronizacion en un solo lugar.</p>
                  <p class="metrics-sub" id="metrics-insights"></p>
                </div>
	                <div class="metrics-controls">
	                  <div class="metrics-control">
	                    <label for="metrics-range">Rango</label>
	                    <select id="metrics-range">
	                      <option value="day">Hoy</option>
	                      <option value="week">Semana</option>
	                      <option value="month" selected>Mes</option>
	                    </select>
	                  </div>
	                  <div class="metrics-control metrics-downloads">
	                    <label for="metrics-report">Reportes (CSV)</label>
	                    <div class="metrics-download-row">
	                      <select id="metrics-report">
	                        <option value="orders" selected>Ventas (Pedidos Shopify)</option>
	                        <option value="invoices">Facturación (Facturas Alegra)</option>
	                        <option value="top_products_revenue">Top ventas por producto</option>
	                        <option value="repeat_customers">Clientes recurrentes</option>
	                        <option value="dead_stock">Stock muerto</option>
	                      </select>
	                      <button class="ghost" id="metrics-report-download" type="button">Descargar</button>
	                    </div>
	                  </div>
	                  <div class="metrics-status">
	                    <span class="status-pill" id="metrics-shopify-status">Shopify</span>
	                    <span class="status-pill" id="metrics-alegra-status">Alegra</span>
	                  </div>
	                </div>
	              </div>

              <div class="section-title">Panel de Victorias</div>
              <div class="kpi-grid metrics-kpi-grid victories-kpis">
                <div class="kpi-card">
                  <p id="kpi-shopify-label">Pedidos Shopify</p>
                  <span class="kpi-source">Fuente: Shopify</span>
                  <h2 id="kpi-sales-today">--</h2>
                  <span class="kpi-sub" id="kpi-sales-today-sub">Vs ayer</span>
                </div>
                <div class="kpi-card">
                  <p id="kpi-alegra-label">Facturacion Alegra</p>
                  <span class="kpi-source">Fuente: Alegra</span>
                  <h2 id="kpi-billing-alegra">--</h2>
                  <span class="kpi-sub" id="kpi-billing-alegra-sub">Vs mes pasado</span>
                </div>
                <div class="kpi-card kpi-chart">
                  <p id="chart-weekly-label">Crecimiento pedidos</p>
                  <span class="kpi-source">Fuente: Shopify</span>
                  <div class="chart-placeholder chart-compact" id="chart-weekly"></div>
                </div>
                <div class="kpi-card kpi-chart" id="chart-alegra-card">
                  <p id="chart-alegra-label">Crecimiento facturacion</p>
                  <span class="kpi-source">Fuente: Alegra</span>
                  <div class="chart-placeholder chart-compact" id="chart-alegra"></div>
                </div>
              </div>

              <div class="metrics-victories">
                <div class="panel" id="panel-top-products">
                  <div class="panel-header">
                    <h3>Top 10 Productos Estrella</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Shopify</span>
                      <span class="panel-tag">Unidades</span>
                    </div>
                  </div>
                  <div class="chart-placeholder" id="wins-top-products"></div>
                </div>
                <div class="panel" id="panel-top-revenue">
                  <div class="panel-header">
                    <h3>Top 10 Generadores de Caja</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Shopify</span>
                      <span class="panel-tag">Facturacion</span>
                    </div>
                  </div>
                  <div class="table-card">
                    <table class="table" id="wins-top-revenue">
                      <thead>
                        <tr>
                          <th>Producto</th>
                          <th>Total</th>
                          <th>Unidades</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
                <div class="panel" id="panel-top-cities">
                  <div class="panel-header">
                    <h3>Top 10 Ciudades Destino</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Shopify</span>
                      <span class="panel-tag">Colombia</span>
                    </div>
                  </div>
                  <div class="chart-placeholder" id="wins-top-cities"></div>
                </div>
	                <div class="panel" id="panel-top-customers">
	                  <div class="panel-header">
	                    <h3>Top 10 Clientes Recurrentes</h3>
	                    <div class="panel-meta">
	                      <span class="panel-source">Fuente: Shopify</span>
	                      <span class="panel-tag">Pedidos</span>
	                    </div>
	                  </div>
	                  <div class="table-card">
	                    <table class="table" id="wins-top-customers">
	                      <thead>
	                        <tr>
	                          <th>Cliente</th>
	                          <th>Pedidos</th>
	                          <th>Ticket Promedio</th>
	                          <th>Total</th>
	                        </tr>
	                      </thead>
	                      <tbody></tbody>
	                    </table>
	                  </div>
	                </div>
                <div class="panel" id="panel-payment-methods">
                  <div class="panel-header">
                    <h3>Participacion por Metodos de Pago</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Alegra</span>
                      <span class="panel-tag">Alegra</span>
                    </div>
                  </div>
                  <div class="chart-placeholder" id="wins-payment-methods"></div>
                </div>
              </div>

              <div class="section-title">Panel de Control y Ajustes</div>
              <div class="metrics-attention">
                <div class="panel" id="panel-inventory-alerts">
                  <div class="panel-header">
                    <h3>Alertas de Inventario y Stock</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Alegra</span>
                      <span class="panel-tag">Operativo</span>
                    </div>
                  </div>
                  <div class="panel-split">
                    <div class="table-card" id="card-low-stock">
	                      <h4 class="panel-subtitle">Próximos a agotarse</h4>
	                      <table class="table" id="alert-low-stock">
	                        <thead>
	                          <tr>
	                            <th>Producto</th>
	                            <th>Stock</th>
	                            <th>Ventas 30d</th>
	                          </tr>
	                        </thead>
	                        <tbody></tbody>
	                      </table>
	                    </div>
	                    <div class="table-card" id="card-inactive-products">
	                      <h4 class="panel-subtitle">Stock muerto (sin ventas 30d)</h4>
	                      <table class="table" id="alert-inactive-products">
	                        <thead>
	                          <tr>
	                            <th>Producto</th>
	                            <th>Stock</th>
	                            <th>Ventas 30d</th>
	                          </tr>
	                        </thead>
	                        <tbody></tbody>
	                      </table>
	                    </div>
	                  </div>
	                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="profile">
          <div class="panel" id="profile-panel">
            <div class="panel-header">
              <h3>Perfil</h3>
              <span class="panel-tag">Usuario</span>
            </div>
            <div class="settings-grid">
              <div class="field">
                <label>Nombre</label>
                <input type="text" id="profile-name" placeholder="Nombre completo" />
              </div>
              <div class="field">
                <label>Email</label>
                <input type="email" id="profile-email" placeholder="correo@empresa.com" />
              </div>
              <div class="field">
                <label>Telefono</label>
                <input type="tel" id="profile-phone" placeholder="+57..." />
              </div>
              <div class="field">
                <label>Foto de perfil</label>
                <input type="file" id="profile-photo" accept="image/*" />
              </div>
              <div class="field field-actions">
                <label>&nbsp;</label>
                <button class="primary" id="profile-save" type="button">Guardar perfil</button>
              </div>
              <div class="field">
                <label>Contrasena actual</label>
                <input type="password" id="password-current" autocomplete="current-password" />
              </div>
              <div class="field">
                <label>Nueva contrasena</label>
                <input type="password" id="password-new" autocomplete="new-password" />
              </div>
              <div class="field">
                <label>Confirmar contrasena</label>
                <input type="password" id="password-confirm" autocomplete="new-password" />
              </div>
              <div class="field field-actions">
                <label>&nbsp;</label>
                <button class="primary" id="password-save" type="button">Cambiar contrasena</button>
              </div>
              <div class="field field-span">
                <p class="field-hint" id="password-message"></p>
              </div>
            </div>
            <p class="field-hint" id="profile-message"></p>
          </div>
        </section>

        <section class="section" id="superadmin">
          <div class="panel">
            <div class="panel-header">
              <h3>Super Admin</h3>
              <span class="panel-tag">Cobro y medición</span>
            </div>
            <div class="toolbar products-toolbar">
              <select id="sa-tab">
                <option value="tenant" selected>Tenant</option>
                <option value="services">Servicios</option>
                <option value="plans">Planes</option>
              </select>
              <div class="toolbar-store">
                <label for="sa-tenant">Tenant</label>
                <select id="sa-tenant"></select>
              </div>
              <input type="month" id="sa-period" />
              <button class="primary" id="sa-load" type="button">Cargar</button>
              <button class="ghost danger" id="sa-reset" type="button" title="Resetea contadores del mes (no borra histórico)">Resetear contadores</button>
            </div>
            <p class="field-hint" id="sa-status">Sin datos</p>

            <div class="panel" id="sa-pane-tenant">
              <div class="panel-header">
                <h3>Plan, módulos y consumo</h3>
                <div class="panel-meta">
                  <span class="panel-source">tenant_plans · tenant_modules · usage_counters · billing_counters</span>
                  <span class="panel-tag">Por tenant</span>
                </div>
              </div>

              <div class="toolbar products-toolbar">
                <div class="toolbar-store">
                  <label for="sa-plan-key">Asignar plan</label>
                  <select id="sa-plan-key"></select>
                </div>
                <button class="primary" id="sa-assign-plan" type="button">Asignar</button>
              </div>
              <div class="mode-grid" id="sa-snapshot-grid" aria-label="Snapshot del plan">
                <div class="mode-field">
                  <label for="sa-snapshot-tenant-id">Tenant ID</label>
                  <input id="sa-snapshot-tenant-id" disabled />
                </div>
                <div class="mode-field">
                  <label for="sa-snapshot-plan-key">Plan key</label>
                  <input id="sa-snapshot-plan-key" disabled />
                </div>
                <div class="mode-field">
                  <label for="sa-snapshot-plan-type">Plan type</label>
                  <input id="sa-snapshot-plan-type" disabled />
                </div>
                <div class="mode-field">
                  <label for="sa-snapshot-monthly-price">Precio mensual</label>
                  <input id="sa-snapshot-monthly-price" disabled />
                </div>
                <div class="mode-field">
                  <label for="sa-snapshot-updated-at">Actualizado</label>
                  <input id="sa-snapshot-updated-at" disabled />
                </div>
              </div>
              <div class="table-card">
                <table class="table" id="sa-snapshot-services-table">
                  <thead>
                    <tr>
                      <th>Servicio</th>
                      <th>Periodo</th>
                      <th>Ilimitado</th>
                      <th>Max</th>
                      <th>Precio unitario</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="5" class="empty">Selecciona un tenant y carga.</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="panel" id="sa-tenant-modules-panel">
                <div class="panel-header">
                  <h3>Módulos del tenant</h3>
                  <div class="panel-meta">
                    <span class="panel-source">tenant_modules</span>
                  </div>
                </div>
                <div class="table-card">
                  <table class="table" id="sa-modules-table">
                    <thead>
                      <tr>
                        <th>Módulo</th>
                        <th>Habilitado</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr><td colspan="2" class="empty">Sin datos</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="panel-header">
                <h3>Consumo del mes</h3>
                <div class="panel-meta">
                  <span class="panel-source">usage_counters / billing_counters</span>
                  <span class="panel-tag">Mensual</span>
                </div>
              </div>
              <div class="table-card">
                <table class="table" id="sa-usage-table">
                  <thead>
                    <tr>
                      <th>Servicio</th>
                      <th>Consumo</th>
                      <th>Cobrado (qty)</th>
                      <th>Cobrado (total)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="4" class="empty">Sin datos</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="panel" id="sa-pane-services" style="display:none">
              <div class="panel-header">
                <h3>Servicios medibles</h3>
                <div class="panel-meta">
                  <span class="panel-source">limit_definitions</span>
                  <span class="panel-tag">Catálogo</span>
                </div>
              </div>
              <div class="table-card">
                <table class="table" id="sa-services-table">
                  <thead>
                    <tr>
                      <th>Key</th>
                      <th>Nombre</th>
                      <th>Periodo</th>
                      <th>Activo</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="4" class="empty">Sin datos</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="toolbar products-toolbar">
                <div class="toolbar-store">
                  <label for="sa-service-key">Key</label>
                  <input id="sa-service-key" placeholder="orders" />
                </div>
                <div class="toolbar-store">
                  <label for="sa-service-name">Nombre</label>
                  <input id="sa-service-name" placeholder="Pedidos" />
                </div>
                <div class="toolbar-store">
                  <label for="sa-service-period">Periodo</label>
                  <select id="sa-service-period">
                    <option value="monthly" selected>Mensual</option>
                    <option value="total">Total</option>
                  </select>
                </div>
                <label class="toggle-row">
                  <input type="checkbox" id="sa-service-active" class="toggle" checked />
                  <span>Activo</span>
                </label>
                <button class="primary" id="sa-service-save" type="button">Guardar</button>
              </div>
              <p class="field-hint">Ejemplos: <b>orders</b>, <b>invoices</b>, <b>products</b>, <b>api_calls</b>. Key solo letras/números/underscore.</p>
            </div>

            <div class="panel" id="sa-pane-plans" style="display:none">
              <div class="panel-header">
                <h3>Planes y cobro por servicio</h3>
                <div class="panel-meta">
                  <span class="panel-source">plan_definitions · plan_service_limits</span>
                  <span class="panel-tag">Configuración</span>
                </div>
              </div>
              <div class="toolbar products-toolbar">
                <div class="toolbar-store">
                  <label for="sa-plan-limits-key">Plan</label>
                  <select id="sa-plan-limits-key"></select>
                </div>
                <button class="ghost" id="sa-plan-limits-load" type="button">Cargar</button>
              </div>
              <p class="field-hint">Pro: cobra excedentes. On Demand: cobra cada evento. Master: ilimitado sin cobro.</p>
              <div class="table-card">
                <table class="table" id="sa-plan-limits-table">
                  <thead>
                    <tr>
                      <th>Servicio</th>
                      <th>Ilimitado</th>
                      <th>Límite</th>
                      <th>Precio unitario</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="5" class="empty">Sin datos</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="marketing">
          <div class="panel">
            <div class="panel-header">
              <h3>Marketing &amp; Analytics</h3>
              <span class="panel-tag">Shopify</span>
            </div>
            <div class="toolbar products-toolbar">
              <div class="toolbar-store">
                <label for="marketing-store-select">Tienda</label>
                <select id="marketing-store-select"></select>
              </div>
              <input type="date" id="marketing-from" aria-label="Fecha inicio" />
              <input type="date" id="marketing-to" aria-label="Fecha fin" />
              <button class="primary" id="marketing-refresh" type="button">Cargar dashboard</button>
              <button class="ghost" id="marketing-sync" type="button" title="Backfill de pedidos desde Shopify">Sincronizar pedidos</button>
              <button class="ghost" id="marketing-recompute" type="button" title="Recalcular métricas diarias">Recalcular métricas</button>
            </div>
            <p class="field-hint" id="marketing-status">Sin datos</p>

            <div class="kpi-grid metrics-kpi-grid">
              <div class="kpi-card">
                <p>Revenue</p>
                <span class="kpi-source">Fuente: Shopify</span>
                <h2 id="mk-kpi-revenue">--</h2>
                <span class="kpi-sub">Rango seleccionado</span>
              </div>
              <div class="kpi-card">
                <p>Spend</p>
                <span class="kpi-source">Fuente: Campaign spend</span>
                <h2 id="mk-kpi-spend">--</h2>
                <span class="kpi-sub">Importado / cargado</span>
              </div>
              <div class="kpi-card">
                <p>ROAS</p>
                <span class="kpi-source">Revenue / Spend</span>
                <h2 id="mk-kpi-roas">--</h2>
                <span class="kpi-sub">Por rango</span>
              </div>
              <div class="kpi-card">
                <p>AOV</p>
                <span class="kpi-source">Revenue / Paid orders</span>
                <h2 id="mk-kpi-aov">--</h2>
                <span class="kpi-sub">Ticket promedio</span>
              </div>
            </div>

            <div class="metrics-victories">
              <div class="panel">
                <div class="panel-header">
                  <h3>Funnel (Sessions → Cart → Checkout → Paid)</h3>
                  <div class="panel-meta">
                    <span class="panel-source">Pixel + Webhooks</span>
                    <span class="panel-tag">Conversión</span>
                  </div>
                </div>
                <div class="table-card">
                  <table class="table" id="mk-funnel-table">
                    <thead>
                      <tr>
                        <th>Sessions</th>
                        <th>Add to cart</th>
                        <th>Checkout</th>
                        <th>Paid</th>
                        <th>Session→Cart</th>
                        <th>Cart→Checkout</th>
                        <th>Checkout→Paid</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td colspan="7" class="empty">Sin datos</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <h3>Revenue diario</h3>
                  <div class="panel-meta">
                    <span class="panel-source">marketing.daily_metrics</span>
                    <span class="panel-tag">Serie</span>
                  </div>
                </div>
                <div class="chart-placeholder" id="mk-revenue-series"></div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <h3>Revenue por canal</h3>
                  <div class="panel-meta">
                    <span class="panel-source">UTM + referrer</span>
                    <span class="panel-tag">Top</span>
                  </div>
                </div>
                <div class="chart-placeholder" id="mk-by-channel"></div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <h3>Top campañas (UTM)</h3>
                  <div class="panel-meta">
                    <span class="panel-source">UTM Campaign</span>
                    <span class="panel-tag">ROAS</span>
                  </div>
                </div>
                <div class="table-card">
                  <table class="table" id="mk-top-campaigns">
                    <thead>
                      <tr>
                        <th>Campaña</th>
                        <th>Revenue</th>
                        <th>Paid</th>
                        <th>ROAS</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td colspan="4" class="empty">Sin datos</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </section>

		        <section class="section" id="operations">
		          <div class="panel">
		            <div class="panel-header">
		              <h3 id="ops-title">Gestion de pedidos</h3>
		              <span class="panel-tag" id="ops-tag">Pedidos</span>
		            </div>
	            <div class="toolbar products-toolbar">
	              <div class="toolbar-store">
	                <label for="orders-store-select">Tienda</label>
                <select id="orders-store-select"></select>
              </div>
              <input type="text" id="ops-search" placeholder="Buscar por orden, cliente o producto" />
              <input type="date" id="orders-date-filter" />
              <select id="orders-days">
                <option value="7">Ultimos 7 dias</option>
                <option value="15">Ultimos 15 dias</option>
                <option value="30" selected>Ultimos 30 dias</option>
                <option value="60">Ultimos 60 dias</option>
                <option value="90">Ultimos 90 dias</option>
              </select>
              <select id="orders-sort">
                <option value="date_desc">Orden: Fecha (recientes)</option>
                <option value="date_asc">Orden: Fecha (antiguos)</option>
                <option value="order_asc">Orden: Numero (asc)</option>
                <option value="order_desc">Orden: Numero (desc)</option>
              </select>
              <input type="number" id="orders-limit" min="1" placeholder="Filas por pagina" />
              <button class="ghost" id="ops-search-btn">Buscar</button>
              <button class="primary" id="orders-refresh">Refrescar</button>
              <button class="ghost" id="orders-clear">Borrar filtros</button>
            </div>
	            <div class="ops-view" data-ops-view="orders">
	              <div class="sync-progress" id="orders-progress" aria-hidden="true">
	                <div class="sync-progress-track">
	                  <div class="sync-progress-bar" id="orders-progress-bar"></div>
	                </div>
	                <span class="sync-progress-label" id="orders-progress-label">Sincronizando 0%</span>
	              </div>
	              <div class="table-card orders-table">
	                <table class="table" id="ops-table">
	                  <thead>
	                    <tr>
	                      <th>Fecha</th>
	                      <th>Nro. Orden</th>
	                      <th>Cliente</th>
	                      <th>Productos</th>
	                      <th>Estado Alegra</th>
	                      <th>Accion</th>
	                      <th>Nro. Factura</th>
	                    </tr>
	                  </thead>
	                  <tbody>
	                    <tr>
	                      <td colspan="7" class="empty">Sin ordenes para mostrar.</td>
	                    </tr>
	                  </tbody>
	                </table>
	              </div>
	              <div class="products-footer orders-footer">
	                <span id="orders-page">Pagina 1</span>
	                <div class="products-pagination">
	                  <button class="ghost" id="orders-prev">Anterior</button>
	                  <button class="ghost" id="orders-next">Siguiente</button>
	                </div>
	                <div class="products-pagination">
	                  <input type="number" id="orders-page-input" min="1" placeholder="Ir a" />
	                  <button class="ghost" id="orders-page-go">Ir</button>
	                </div>
	                <span id="orders-count">Mostrando 0 de 0</span>
	              </div>
	            </div>

			            <div class="ops-view is-hidden" data-ops-view="invoices">
		              <div class="table-card orders-table">
		                <table class="table" id="invoices-table">
	                  <thead>
	                    <tr>
	                      <th>Fecha</th>
	                      <th>Nro. Factura</th>
	                      <th>Cliente</th>
	                      <th>Total</th>
	                      <th>Estado</th>
	                      <th>Accion</th>
	                    </tr>
	                  </thead>
	                  <tbody>
	                    <tr>
	                      <td colspan="6" class="empty">Sin facturas para mostrar.</td>
	                    </tr>
	                  </tbody>
	                </table>
	              </div>
	              <div class="products-footer orders-footer">
	                <span id="invoices-page">Pagina 1</span>
	                <div class="products-pagination">
	                  <button class="ghost" id="invoices-prev">Anterior</button>
	                  <button class="ghost" id="invoices-next">Siguiente</button>
	                </div>
	                <div class="products-pagination">
	                  <input type="number" id="invoices-page-input" min="1" placeholder="Ir a" />
	                  <button class="ghost" id="invoices-page-go">Ir</button>
	                </div>
	                <span id="invoices-count">Mostrando 0 de 0</span>
	              </div>
	            </div>
	          </div>
	        </section>

        <section class="section" id="products">
          <div class="panel">
            <div class="panel-header">
              <h3>Gestion de productos</h3>
              <span class="panel-tag">Alegra → Shopify</span>
            </div>
            <div class="toolbar products-toolbar">
              <div class="toolbar-store">
                <label for="products-store-select">Tienda</label>
                <select id="products-store-select"></select>
              </div>
              <input type="text" id="products-search" placeholder="Buscar por nombre o referencia" />
              <input type="date" id="products-date-filter" />
              <select id="products-sort">
                <option value="date_desc">Orden: Fecha (recientes)</option>
                <option value="date_asc">Orden: Fecha (antiguos)</option>
                <option value="ref_asc">Orden: Referencia (A-Z)</option>
                <option value="ref_desc">Orden: Referencia (Z-A)</option>
              </select>
              <input type="number" id="products-limit" min="1" max="30" value="30" placeholder="Limite listado" />
              <button class="ghost" id="products-search-btn">Buscar</button>
              <button class="primary" id="products-refresh">Refrescar</button>
              <button class="ghost" id="products-clear">Borrar filtros</button>
              <button class="primary toolbar-right" id="products-photos-bulk-open" type="button">Fotos masivo</button>
            </div>
            <div class="toolbar products-filters">
              <div class="filter-group">
                <label class="filter-label">Bodegas</label>
                <details class="multi-select">
                  <summary>
                    <span>Seleccionar bodegas</span>
                    <em id="products-warehouse-summary">Todas</em>
                  </summary>
                  <div class="checkbox-grid single" id="products-warehouse-filter"></div>
                </details>
              </div>
              <label class="filter-inline">
                <input type="checkbox" id="products-instock-only" />
                <span>Solo con existencias</span>
              </label>
              <select id="products-status-filter">
                <option value="all">Estado Alegra: Todos</option>
                <option value="active">Activos</option>
                <option value="inactive">Inactivos</option>
              </select>
            </div>
            <div class="sync-progress" id="products-progress" aria-hidden="true">
              <div class="sync-progress-track">
                <div class="sync-progress-bar" id="products-progress-bar"></div>
              </div>
              <span class="sync-progress-label" id="products-progress-label">Sincronizando 0%</span>
            </div>
            <div class="table-card products-table">
                <table class="table" id="products-table">
                  <thead>
                    <tr>
                      <th>Producto / Referencia</th>
                      <th>ID Alegra</th>
                      <th>ID Shopify</th>
	                      <th>Referencia/SKU</th>
                      <th>Fecha</th>
                      <th>Estado Alegra</th>
                      <th>Stock total</th>
                      <th>Estado Shopify</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td colspan="9" class="empty">Sin productos para mostrar.</td>
                    </tr>
                  </tbody>
                </table>
            </div>
            <div class="products-footer">
              <span id="products-page">Pagina 1</span>
              <div class="products-pagination">
                <button class="ghost" id="products-prev">Anterior</button>
                <button class="ghost" id="products-next">Siguiente</button>
              </div>
              <div class="products-pagination">
                <input type="number" id="products-page-input" min="1" placeholder="Ir a" />
                <button class="ghost" id="products-page-go">Ir</button>
              </div>
              <span id="products-count">Mostrando 0 de 0</span>
              <span class="products-status" id="products-status">Listo para sincronizar</span>
            </div>
          </div>
        </section>

        <section class="section" id="contacts">
          <div class="panel">
            <div class="panel-header">
              <h3>Gestion de contactos</h3>
              <span class="panel-tag">Contactos</span>
            </div>
            <div class="toolbar products-toolbar">
              <div class="toolbar-store">
                <label for="contacts-store-select">Tienda</label>
                <select id="contacts-store-select"></select>
              </div>
              <input type="text" id="contacts-search" placeholder="Buscar por nombre, email o telefono" />
              <input type="date" id="contacts-date-start" />
              <input type="date" id="contacts-date-end" />
              <select id="contacts-status">
                <option value="">Estado: Todos</option>
                <option value="synced">Sincronizado</option>
                <option value="pending">Pendiente</option>
              </select>
              <select id="contacts-source">
                <option value="">Origen: Todos</option>
                <option value="shopify">Shopify</option>
                <option value="alegra">Alegra</option>
              </select>
              <input type="number" id="contacts-limit" min="1" placeholder="Filas por pagina" />
              <button class="ghost" id="contacts-search-btn">Buscar</button>
              <button class="primary" id="contacts-refresh">Refrescar</button>
	              <button class="ghost" id="contacts-clear">Borrar filtros</button>
	            </div>
	            <div class="sync-progress" id="contacts-progress" aria-hidden="true">
	              <div class="sync-progress-track">
	                <div class="sync-progress-bar" id="contacts-progress-bar"></div>
	              </div>
	              <span class="sync-progress-label" id="contacts-progress-label">Sincronizando 0%</span>
	            </div>
	            <div class="table-card">
              <table class="table" id="contacts-table">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Telefono</th>
                    <th>Documento</th>
                    <th>Origen</th>
                    <th>Estado</th>
                    <th>Shopify</th>
                    <th>Alegra</th>
                    <th>Actualizado</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="9" class="empty">Sin contactos para mostrar.</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="products-footer">
              <span id="contacts-page">Pagina 1</span>
              <div class="products-pagination">
                <button class="ghost" id="contacts-prev">Anterior</button>
                <button class="ghost" id="contacts-next">Siguiente</button>
              </div>
              <div class="products-pagination">
                <input type="number" id="contacts-page-input" min="1" placeholder="Ir a" />
                <button class="ghost" id="contacts-page-go">Ir</button>
              </div>
              <span id="contacts-count">Mostrando 0 de 0</span>
            </div>
          </div>
        </section>

        <section class="section" id="logs">
          <div class="panel">
            <div class="panel-header">
              <h3>Logs de API</h3>
              <span class="panel-tag">Trazabilidad</span>
            </div>
            <div class="toolbar">
              <input type="text" placeholder="ID de pedido" id="log-order-id" />
              <select id="log-status">
                <option value="">Todos</option>
                <option value="success">Exitosos</option>
                <option value="fail">Errores</option>
                <option value="retrying">Reintentando</option>
              </select>
              <button class="ghost" id="log-filter">Filtrar</button>
              <button class="primary" id="log-retry">Reintentar fallidos</button>
              <span class="status-pill" id="queue-status">Sin datos</span>
            </div>
            <table class="table" id="log-table">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Entidad</th>
                  <th>Direccion</th>
                  <th>Estado</th>
                  <th>Detalle</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="6" class="empty">Sin datos.</td>
                </tr>
              </tbody>
            </table>
          </div>
	        </section>

		        <section class="section" id="settings">
		          <div class="settings-pane is-active" id="settings-pane">
                <div class="settings-group-title">Conexiones</div>
				            <div class="panel admin-only module" data-module="connections" data-module-readonly="false" data-setup-open="0" data-help="Configurar tienda (paso a paso):&#10;1) En Nueva conexion: elige configuracion guiada o manual.&#10;2) Conecta Shopify (autorizacion) y luego Alegra (clave de acceso o cuenta guardada).&#10;3) En Tiendas: confirma la tienda activa (ej: Oliva Shoes Colombia).&#10;4) Configura Productos, Pedidos y Contactos segun tu forma de trabajo.&#10;5) Revisa Operacion (sincronizacion automatica y salud).&#10;&#10;Tip: la configuracion guiada es para tienda nueva; si ya hay tienda activa, usa Manual.">
		            <div class="panel-header">
		              <h3 data-module-toggle="connections" data-title-base="Nueva conexion">Nueva conexion</h3>
		              <span class="panel-tag">Acceso</span>
	            </div>
	            <div class="module-body">
              <div class="setup-mode-picker" id="setup-mode-picker" aria-label="Modo de configuracion">
                <button class="setup-mode" type="button" data-setup-mode="guided">Configuracion guiada</button>
                <button class="setup-mode" type="button" data-setup-mode="manual">Configuracion manual</button>
              </div>
	              <div class="connections-form" id="connections-form">
	              <div class="settings-grid store-meta">
		                <div class="field span-2">
		                  <label>Nombre de la tienda <span class="tip" data-tip="Nombre visible de la tienda. Se usa para identificar esta configuracion y aparece en Tiendas.">?</span></label>
		                  <input type="text" id="store-name" placeholder="Tienda de ejemplo" />
		                  <span class="field-hint">Este nombre identifica el set de configuraciones.</span>
	                </div>
	                <div class="field span-2" id="copy-config-field">
	                  <label>Configuracion inicial <span class="tip" data-tip="Opcional. Si ya tienes otra tienda configurada, puedes copiar reglas y sincronizaciones para no empezar desde cero.">?</span></label>
	                  <select id="copy-config-select"></select>
	                  <span class="field-hint">Copia configuracion desde otra tienda o inicia en blanco.</span>
	                </div>
	              </div>
	              <div class="connections-groups">
                  <div class="connections-group" data-group="commerce">
                    <div class="connections-group-header">
                      <div class="group-title">
                        <span class="group-kicker">Commerce</span>
                        <h4>Shopify</h4>
                      </div>
                      <span class="status-pill is-live">Core</span>
                    </div>
                    <div class="connections-group-body">
                      <div class="connection-block">
                        <div class="connection-block-header">
                          <div>
                            <div class="provider-title">
                              <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
                              <h4>Shopify</h4>
                            </div>
                            <p class="kpi-sub">Autorizacion de Shopify para esta tienda</p>
                          </div>
                          <div class="connection-block-actions">
                            <span class="status-pill is-off" id="shopify-connection-pill">Pendiente</span>
                            <button class="primary" id="connect-shopify" type="button">Conectar Shopify</button>
                          </div>
                        </div>
                        <div class="settings-grid connection-fields">
                          <div class="field span-2">
                            <label>Shopify dominio <span class="tip" data-tip="Dominio de la tienda (ej: tu-tienda.myshopify.com). Se usa para conectar Shopify a esta integracion.">?</span></label>
                            <input type="text" id="shopify-domain" placeholder="tu-tienda.myshopify.com" />
                            <span class="field-hint">Se usa para iniciar la autorizacion de Shopify.</span>
                          </div>
                          <div class="field span-2">
                            <label>Metodo de conexion <span class="tip" data-tip="Elige como conectar Shopify: por autorizacion (OAuth2) o por clave de acceso (Admin API).">?</span></label>
                            <div class="setup-mode-picker" id="shopify-connect-picker" aria-label="Metodo de conexion Shopify">
                              <button class="setup-mode is-active" type="button" data-shopify-connect="oauth">Por autorizacion</button>
                              <button class="setup-mode" type="button" data-shopify-connect="token">Por clave de acceso</button>
                            </div>
                            <span class="field-hint" id="shopify-connect-hint">Por autorizacion abre la pantalla de Shopify para conectar esta tienda.</span>
                          </div>
                          <div class="field span-2" id="shopify-token-field">
                            <label>Clave de acceso Shopify <span class="tip" data-tip="Pega aqui la clave de acceso (Admin API) de Shopify para esta tienda y presiona Conectar Shopify.">?</span></label>
                            <input type="password" id="shopify-token" placeholder="shpat_********" autocomplete="new-password" />
                            <span class="field-hint">Se guarda cifrada. Usala si no puedes conectar por autorizacion.</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="connections-group" data-group="accounting">
                    <div class="connections-group-header">
                      <div class="group-title">
                        <span class="group-kicker">Contabilidad</span>
                        <h4>Alegra</h4>
                      </div>
                    </div>
                    <div class="connections-group-body">
                      <div class="connection-block">
                        <div class="connection-block-header">
                          <div>
                            <div class="provider-title">
                              <img class="provider-logo" src="/brands/alegra.png?v=20260201s" alt="Alegra" />
                              <h4>Alegra</h4>
                            </div>
                            <p class="kpi-sub">Cuenta y credenciales</p>
                          </div>
                          <div class="connection-block-actions">
                            <span class="status-pill is-off" id="alegra-connection-pill">Pendiente</span>
                            <button class="primary" id="connect-alegra" type="button">Conectar Alegra</button>
                          </div>
                        </div>
                        <div class="settings-grid connection-fields">
                          <div class="field">
                            <label>Cuenta Alegra <span class="tip" data-tip="Selecciona una cuenta guardada o crea una nueva con email + clave de acceso.">?</span></label>
                            <select id="alegra-account-select">
                              <option value="new">Nueva cuenta Alegra</option>
                            </select>
                          </div>
                          <div class="field" id="alegra-env-field">
                            <label>Entorno Alegra <span class="tip" data-tip="Produccion es el entorno real. Pruebas es para validar sin afectar tu operacion (si tu cuenta lo soporta).">?</span></label>
                            <select id="alegra-env-select">
                              <option value="prod">Produccion</option>
                              <option value="sandbox">Pruebas</option>
                            </select>
                          </div>
                          <div class="field">
                            <label>Email usuario <span class="tip" data-tip="Email del usuario de Alegra con acceso a la cuenta.">?</span></label>
                            <input type="email" id="alegra-email" placeholder="admin@empresa.com" />
                          </div>
                          <div class="field">
                            <label>Clave de acceso <span class="tip" data-tip="Clave de acceso de Alegra (se guarda cifrada). Si seleccionas una cuenta guardada y te pide reconectar, pega la clave aqui para actualizarla.">?</span></label>
                            <input type="password" id="alegra-key" placeholder="api_********" autocomplete="new-password" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="connections-group" data-group="marketing-ads">
                    <div class="connections-group-header">
                      <div class="group-title">
                        <span class="group-kicker">Marketing Ads</span>
                        <h4>Google · Meta · TikTok</h4>
                      </div>
                    </div>
                    <div class="connections-group-body">
                      <div class="connection-block ads-host-block">
                        <div class="connection-block-header">
                          <div>
                            <div class="provider-title">
                              <h4>Base URL (OAuth)</h4>
                            </div>
                            <p class="kpi-sub">Dominio publico del backend para callbacks.</p>
                          </div>
                          <div class="connection-block-actions">
                            <button class="primary" id="ads-app-save" type="button">Guardar credenciales</button>
                          </div>
                        </div>
                        <div class="settings-grid connection-fields">
                          <div class="field span-2">
                            <label>Base URL (APP_HOST) <span class="tip" data-tip="Ej: https://tu-app.onrender.com">?</span></label>
                            <input type="text" id="ads-app-host" placeholder="https://tu-app.onrender.com" />
                          </div>
                        </div>
                      </div>
                      <div class="ads-platform-grid">
                        <div class="connection-block ads-platform">
                          <div class="connection-block-header">
                            <div class="provider-title">
                              <img class="provider-logo" src="/brands/googleads.png?v=20260201s" alt="Google Ads" />
                              <h4>Google Ads</h4>
                            </div>
                            <span class="status-pill is-off" id="google-ads-connection-pill">Sin conectar</span>
                          </div>
                          <p class="kpi-sub">Credenciales + gasto diario por campaña.</p>
                          <div class="settings-grid connection-fields">
                            <div class="field span-2">
                              <label>Client ID</label>
                              <input type="text" id="google-ads-client-id" placeholder="xxxx.apps.googleusercontent.com" />
                            </div>
                            <div class="field span-2">
                              <label>Client Secret</label>
                              <input type="password" id="google-ads-client-secret" placeholder="********" autocomplete="new-password" />
                            </div>
                            <div class="field span-2">
                              <label>Developer Token</label>
                              <input type="password" id="google-ads-developer-token" placeholder="********" autocomplete="new-password" />
                            </div>
                            <div class="field span-2">
                              <label>Customer ID <span class="tip" data-tip="Formato 123-456-7890.">?</span></label>
                              <input type="text" id="google-ads-customer-id" placeholder="123-456-7890" />
                            </div>
                          </div>
                          <div class="connection-block-actions">
                            <button class="primary" id="connect-google-ads" type="button">Conectar Google</button>
                          </div>
                        </div>

                        <div class="connection-block ads-platform">
                          <div class="connection-block-header">
                            <div class="provider-title">
                              <img class="provider-logo" src="/brands/meta.png?v=20260201s" alt="Meta Ads" />
                              <h4>Meta Ads</h4>
                            </div>
                            <span class="status-pill is-off" id="meta-ads-connection-pill">Sin conectar</span>
                          </div>
                          <p class="kpi-sub">Credenciales + gasto diario por campaña.</p>
                          <div class="settings-grid connection-fields">
                            <div class="field span-2">
                              <label>App ID</label>
                              <input type="text" id="meta-ads-app-id" placeholder="1234567890" />
                            </div>
                            <div class="field span-2">
                              <label>App Secret</label>
                              <input type="password" id="meta-ads-app-secret" placeholder="********" autocomplete="new-password" />
                            </div>
                            <div class="field span-2">
                              <label>Ad Account ID <span class="tip" data-tip="Solo numeros.">?</span></label>
                              <input type="text" id="meta-ads-account-id" placeholder="1234567890" />
                            </div>
                          </div>
                          <div class="connection-block-actions">
                            <button class="primary" id="connect-meta-ads" type="button">Conectar Meta</button>
                          </div>
                        </div>

                        <div class="connection-block ads-platform">
                          <div class="connection-block-header">
                            <div class="provider-title">
                              <img class="provider-logo" src="/brands/tiktok.png?v=20260201s" alt="TikTok Ads" />
                              <h4>TikTok Ads</h4>
                            </div>
                            <span class="status-pill is-off" id="tiktok-ads-connection-pill">Sin conectar</span>
                          </div>
                          <p class="kpi-sub">Credenciales + gasto diario por campaña.</p>
                          <div class="settings-grid connection-fields">
                            <div class="field span-2">
                              <label>App ID</label>
                              <input type="text" id="tiktok-ads-app-id" placeholder="1234567890" />
                            </div>
                            <div class="field span-2">
                              <label>App Secret</label>
                              <input type="password" id="tiktok-ads-app-secret" placeholder="********" autocomplete="new-password" />
                            </div>
                            <div class="field span-2">
                              <label>Advertiser ID</label>
                              <input type="text" id="tiktok-ads-advertiser-id" placeholder="1234567890" />
                            </div>
                          </div>
                          <div class="connection-block-actions">
                            <button class="primary" id="connect-tiktok-ads" type="button">Conectar TikTok</button>
                          </div>
                        </div>
                      </div>
                  </div>

                  <div class="connections-group" data-group="ai">
                    <div class="connections-group-header">
                      <div class="group-title">
                        <span class="group-kicker">Asistencia</span>
                        <h4>IA</h4>
                      </div>
                    </div>
                    <div class="connections-group-body">
                      <div class="connection-block">
                        <div class="connection-block-header">
                          <div>
                            <div class="provider-title">
                              <img class="provider-logo" src="/brands/openai.png?v=20260201s" alt="OpenAI" />
                              <h4>IA</h4>
                            </div>
                            <p class="kpi-sub">Clave del proveedor de IA</p>
                          </div>
                        </div>
                        <div class="settings-grid connection-fields">
                          <div class="field span-2">
                            <label>Token de IA <span class="tip" data-tip="Clave del proveedor de IA (por ejemplo OpenAI). Se usa para el asistente y soporte.">?</span></label>
                            <input type="password" id="ai-key" placeholder="sk-********" autocomplete="new-password" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
	              </div>
	            </div>
	          </div>
	        </div>

          <div class="settings-group provider-group" data-group="marketing">
            <div class="settings-group-header" data-group-toggle="marketing">
              <h4 class="group-title">
                <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
                Marketing
              </h4>
            </div>
            <div class="settings-group-body">
              <div class="panel admin-only module" data-provider="shopify" data-manager="shopify" data-module="marketing-config" data-module-priority="core" data-help="Configura el Pixel (para sessions / funnel / UTM) y los Webhooks de Marketing. Shopify NO entrega sesiones/UTM de tráfico desde la Admin API; por eso este módulo instala el Pixel y registra eventos para métricas.">
                <div class="panel-header">
                  <h3 data-module-toggle="marketing-config" data-title-base="Marketing (Pixel + Webhooks)">Marketing (Pixel + Webhooks)</h3>
                  <div class="panel-meta">
                    <span class="panel-tag tag-core">Core</span>
                    <span class="panel-tag">Shopify</span>
                  </div>
                </div>
                <div class="module-body">
                  <div class="mode-sections">
                    <div class="mode-section" data-readonly-free="1">
                      <div class="mode-head">
                        <div class="mode-head-left">
                          <h4>Pixel (sessions / add-to-cart / UTM)</h4>
                          <span class="tip" data-tip="Paso 1: genera la Key (por tienda).&#10;Paso 2: pega el script en Shopify → Online Store → Themes → Edit code → layout/theme.liquid (antes de </body>).&#10;Paso 3: espera 1-2 minutos y vuelve a cargar Marketing.">?</span>
                        </div>
                      </div>
                      <div class="mode-grid">
                        <div class="mode-field field-span">
                          <label>Tienda</label>
                          <select id="mk-cfg-store-select"></select>
                        </div>
                        <div class="mode-field field-span">
                          <label>Pixel Key (por tienda)</label>
                          <div class="field-actions inline">
                            <input type="text" id="mk-cfg-pixel-key" readonly placeholder="Cargando..." />
                            <button class="ghost" id="mk-cfg-copy-key" type="button">Copiar</button>
                            <button class="ghost" id="mk-cfg-rotate-key" type="button" title="Genera una nueva key (invalidará la anterior)">Rotar</button>
                          </div>
                          <p class="field-hint" id="mk-cfg-status">Sin datos</p>
                        </div>
                        <div class="mode-field field-span">
                          <label>Script para Shopify (theme.liquid)</label>
                          <div class="field-actions inline">
                            <input type="text" id="mk-cfg-script" readonly placeholder="Cargando..." />
                            <button class="ghost" id="mk-cfg-copy-script" type="button">Copiar script</button>
                            <button class="ghost" id="mk-cfg-test" type="button" title="Envía un evento de prueba (no afecta métricas)">Probar</button>
                          </div>
                          <p class="field-hint">Nota: esto habilita sessions/funnel. Las ventas/UTM de pedidos salen de Shopify (sync/webhooks).</p>
                        </div>
                      </div>
                    </div>

                    <div class="mode-section" data-readonly-free="1">
                      <div class="mode-head">
                        <div class="mode-head-left">
                          <h4>Webhooks de Marketing (orders / checkouts / customers)</h4>
                          <span class="tip" data-tip="Crea webhooks en Shopify apuntando a este endpoint para capturar eventos de pedidos y checkout en tiempo real.">?</span>
                        </div>
                      </div>
                      <div class="mode-grid">
                        <div class="mode-field field-span">
                          <label>Callback URL</label>
                          <div class="field-actions inline">
                            <input type="text" id="mk-cfg-webhook-url" readonly placeholder="Cargando..." />
                            <button class="ghost" id="mk-cfg-copy-webhook" type="button">Copiar URL</button>
                            <button class="primary" id="mk-cfg-create-webhooks" type="button">Crear webhooks</button>
                            <button class="ghost danger" id="mk-cfg-delete-webhooks" type="button">Eliminar webhooks</button>
                          </div>
                          <p class="field-hint" id="mk-cfg-webhooks-status">Sin datos</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <p class="field-hint module-warning is-hidden" data-module-warning="marketing-config"></p>
                </div>
              </div>
            </div>
          </div>

          <div class="panel admin-only module" data-provider="bridge" data-module="connections-summary" data-help="Resumen de conexiones guardadas. Cada tarjeta corresponde a una tienda (multi-tienda).">
            <div class="panel-header">
              <h3 data-module-toggle="connections-summary">Conexiones guardadas</h3>
              <span class="panel-tag tag-bridge">Conexiones</span>
            </div>
            <div class="module-body">
              <div class="connections-grid" id="connections-grid">
                <div class="connection-card empty">Sin conexiones.</div>
              </div>
            </div>
          </div>
	      </div>

				        <div class="settings-section">
          <div class="settings-group-title">Sincronizacion entre tiendas</div>
          <div class="settings-group provider-group" data-group="store-sync">
            <div class="settings-group-header" data-group-toggle="store-sync">
              <h4 class="group-title">
                <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
                Sincronizacion tiendas Shopify
              </h4>
            </div>
            <div class="settings-group-body">
              <div class="panel admin-only module" data-provider="shopify" data-manager="shopify" data-module="store-sync-products" data-help="Copia productos entre tiendas Shopify dentro de tu organizacion. Ideal para clonar catalogos o mover productos de una tienda a otra.">
                <div class="panel-header">
                  <h3 data-module-toggle="store-sync-products" data-title-base="Productos Shopify → Shopify">
                    Productos Shopify → Shopify
                    <span class="tip" data-tip="Copia productos de una tienda Shopify origen a una tienda Shopify destino. Puedes elegir si copiar descripcion, fotos, etiquetas y tipo/categoria.">?</span>
                  </h3>
                  <div class="panel-meta">
                    <span class="panel-tag tag-bridge">Shopify → Shopify</span>
                  </div>
                </div>
                <div class="module-body">
                  <div class="mode-sections">
                    <div class="mode-section">
                      <div class="mode-head">
                        <div class="mode-head-left">
                          <h4>Origen, destino y reglas</h4>
                        </div>
                      </div>
                      <div class="mode-grid">
                        <div class="mode-field">
                          <label for="store-sync-source">Tienda origen</label>
                          <select id="store-sync-source"></select>
                        </div>
                        <div class="mode-field">
                          <label for="store-sync-target">Tienda destino</label>
                          <select id="store-sync-target"></select>
                        </div>
                        <div class="mode-field">
                          <label for="store-sync-alegra-account">Cuenta Alegra</label>
                          <select id="store-sync-alegra-account"></select>
                        </div>
                        <div class="mode-field">
                          <label for="store-sync-price-list">Lista de precios Alegra</label>
                          <select id="store-sync-price-list" data-allow-empty="true" data-empty-label="Seleccionar..."></select>
                        </div>
                        <div class="mode-field">
                          <label for="store-sync-status">Estado destino</label>
                          <select id="store-sync-status">
                            <option value="draft" selected>Borrador</option>
                            <option value="active">Activo</option>
                          </select>
                        </div>
                        <div class="mode-field">
                          <label for="store-sync-price-fallback">Si no hay precio en lista</label>
                          <select id="store-sync-price-fallback">
                            <option value="shopify" selected>Tomar precio original</option>
                            <option value="none">No poner precio</option>
                            <option value="skip">No sincronizar</option>
                          </select>
                        </div>
                      </div>
                      <div class="mode-toggle-grid" aria-label="Opciones de copia">
                        <div class="mode-toggle">
                          <label for="store-sync-only-active">Solo activos en origen <span class="tip" data-tip="Si está ON, solo copia productos activos de la tienda origen.">?</span></label>
                          <input type="checkbox" id="store-sync-only-active" class="toggle" checked />
                        </div>
                        <div class="mode-toggle">
                          <label for="store-sync-include-descriptions">Copiar descripciones <span class="tip" data-tip="Incluye la descripción HTML del producto.">?</span></label>
                          <input type="checkbox" id="store-sync-include-descriptions" class="toggle" checked />
                        </div>
                        <div class="mode-toggle">
                          <label for="store-sync-include-images">Copiar fotos <span class="tip" data-tip="Copia las fotos principales del producto (hasta 15 por producto).">?</span></label>
                          <input type="checkbox" id="store-sync-include-images" class="toggle" checked />
                        </div>
                        <div class="mode-toggle">
                          <label for="store-sync-include-product-type">Copiar tipo/categoría <span class="tip" data-tip="Copia el tipo de producto (categoría interna).">?</span></label>
                          <input type="checkbox" id="store-sync-include-product-type" class="toggle" checked />
                        </div>
                        <div class="mode-toggle">
                          <label for="store-sync-include-tags">Copiar etiquetas <span class="tip" data-tip="Copia las etiquetas (tags) del producto.">?</span></label>
                          <input type="checkbox" id="store-sync-include-tags" class="toggle" checked />
                        </div>
                      </div>
                      <div class="mode-actions">
                        <button class="primary" id="store-sync-run" type="button">Sincronizar productos</button>
                        <button class="ghost" id="store-sync-clear" type="button">Limpiar</button>
                        <span class="kpi-sub" id="store-sync-status-label">Sin datos</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

				          <div class="settings-group-title">Tiendas</div>
				          <div class="panel admin-only" id="stores-switcher-panel" data-help="Tiendas conectadas: elige la tienda activa. Todo lo de abajo (productos, pedidos, contactos, etc.) se guarda por tienda activa.">
				            <div class="panel-header">
				              <h3>
				                Tiendas conectadas
				                <span class="tip" data-tip="Las configuraciones se guardan por tienda. Cambiar la tienda activa no afecta a las demás.">?</span>
				              </h3>
				            </div>
				            <div class="module-body">
				              <div class="store-switcher" id="store-active-field" aria-label="Selector de tienda">
				                <div class="store-switcher-active">
				                  <div>
				                    <div class="store-switcher-kicker">Tienda activa</div>
				                    <div class="store-switcher-name" id="store-active-name">-</div>
				                  </div>
				                  <button class="ghost danger" id="store-delete" type="button" title="Eliminar tienda">Eliminar</button>
				                </div>
				                <div class="store-switcher-items is-wide" id="store-active-list"></div>
				                <div class="field-hint store-scope-hint">Configuración independiente por tienda.</div>
				                <select id="store-active-select" class="is-hidden" aria-hidden="true" tabindex="-1"></select>
				              </div>
				            </div>
				          </div>

			              <div class="settings-group store-group" data-group="store">
			                <div class="settings-group-header" data-group-toggle="store" data-help="Configuracion de la tienda activa: todo lo de abajo aplica solo a la tienda seleccionada arriba.">
			                  <h3 data-store-title data-title-base="Tienda">Tienda</h3>
			                </div>
			                <div class="settings-group-body">

				          <div class="settings-group provider-group" data-group="products">
				                <div class="settings-group-header" data-group-toggle="products">
			                  <h4 class="group-title">
		                    <img class="provider-logo" src="/brands/alegra.png?v=20260201s" alt="Alegra" />
	                    <span class="group-arrow">→</span>
                    <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
                    Productos e inventario
                  </h4>
                </div>
                <div class="settings-group-body">
	                  <div class="panel admin-only module" data-provider="bridge" data-manager="alegra" data-module="shopify-rules" data-module-priority="core" id="legacy-publish-panel" data-help="Modulo principal de Productos: define como se publican y actualizan productos en Shopify cuando llegan cambios desde Alegra (automatico: se sincroniza solo) o cuando publicas manual/masivo desde el panel de Productos.">
                    <div class="panel-header">
			                      <h3 data-module-toggle="shopify-rules" data-title-base="Sincronizar productos (Alegra → Shopify)">
			                        Sincronizar productos (Alegra → Shopify)
				                        <span class="tip" data-tip="Reglas por tienda para sincronizar productos de Alegra a Shopify. Masivo = catálogo inicial o re-sincronización por fechas. Automático = se ejecuta solo cuando llegan cambios desde Alegra.">?</span>
			                      </h3>
                      <div class="panel-meta">
                        <span class="panel-tag tag-core">Core</span>
                        <span class="panel-tag tag-bridge">Alegra → Shopify</span>
                      </div>
                    </div>
                    <div class="module-body">
                      <div class="mode-sections">
	                        <div class="mode-section" data-readonly-free="1">
		                          <div class="mode-head">
		                            <div class="mode-head-left">
					                              <h4>Masivo: productos Alegra → Shopify</h4>
					                              <span class="tip" data-tip="Este masivo se usa para catálogo inicial o re-procesar un rango.&#10;Crea productos en Shopify solo si NO existen (por SKU/Barcode).&#10;Recomendación: prueba con un rango corto y apaga “Publicar” si quieres validar antes.">?</span>
			                            </div>
			                          </div>
                          <div class="mode-grid" id="products-sync-grid">
                            <div class="mode-field">
                              <label for="products-date-start">Fecha inicio</label>
                              <input type="date" id="products-date-start" />
                            </div>
                            <div class="mode-field">
                              <label for="products-date-end">Fecha fin</label>
                              <input type="date" id="products-date-end" />
                            </div>
                            <div class="mode-field">
                              <label for="products-sync-limit">Limite (opcional)</label>
                              <input type="number" id="products-sync-limit" min="1" placeholder="200" />
                            </div>
                            <div class="mode-field" id="cfg-warehouse-sync-field">
                              <label>Bodegas para stock (masivo) <span class="tip" data-tip="Opcional. Si eliges bodegas aquí, el masivo calcula/filtra el stock usando solo esas bodegas. Si dejas “Todas”, usamos las bodegas guardadas en “Inventario y bodegas” (también aplican para automático).">?</span></label>
                              <details class="multi-select">
                                <summary>
                                  <span>Seleccionar bodegas</span>
                                  <em id="cfg-warehouse-sync-summary">Todas</em>
                                </summary>
                                <div class="checkbox-grid single" id="cfg-warehouse-sync"></div>
                              </details>
                            </div>
                          </div>
	                          <div class="mode-toggle-grid" aria-label="Opciones masivo">
		                            <div class="mode-toggle">
		                              <label for="products-sync-only-active">Solo activos en Alegra <span class="tip" data-tip="Si está activo, el masivo ignora productos inactivos en Alegra. Recomendado para evitar crear productos descontinuados en Shopify.">?</span></label>
		                              <input type="checkbox" id="products-sync-only-active" class="toggle" checked />
		                            </div>
				                            <div class="mode-toggle">
				                              <label for="products-sync-update-existing">Actualizar existentes <span class="tip" data-tip="ON: si el producto ya existe, lo actualiza en la base de datos.&#10;Si además “Publicar en Shopify” está ON, también actualiza el producto existente en Shopify (por SKU/Barcode): precio de variantes y estado (draft/active).&#10;OFF: no modifica productos existentes (ni en la base de datos, ni en Shopify); solo guarda productos nuevos.">?</span></label>
				                              <input type="checkbox" id="products-sync-update-existing" class="toggle" checked />
				                            </div>
				                            <div class="mode-toggle">
				                              <label for="products-sync-publish">Publicar en Shopify <span class="tip" data-tip="ON: crea productos nuevos en Shopify.&#10;Si “Actualizar existentes” está ON, también actualiza productos ya existentes en Shopify (por SKU/Barcode).&#10;OFF: no crea ni actualiza nada en Shopify (solo trabaja en la base de datos).&#10;Tip: usa OFF para cargar catálogo y validar antes de publicar.">?</span></label>
				                              <input type="checkbox" id="products-sync-publish" class="toggle" checked />
				                            </div>
				                            <div class="mode-toggle">
				                              <label for="products-publish-status-mass">Estado <span class="tip" data-tip="Borrador = no visible en la tienda. Activo = visible y listo para vender. Solo aplica si “Publicar en Shopify” está activo.">?</span></label>
				                              <select id="products-publish-status-mass" data-depends-on="products-sync-publish">
				                                <option value="draft">Borrador</option>
				                                <option value="active">Activo</option>
				                              </select>
				                            </div>
		                            <div class="mode-toggle">
		                              <label for="products-sync-include-inventory">Incluir inventario <span class="tip" data-tip="ON: trae inventario desde Alegra (y lo guarda en la base de datos).&#10;Si además “Publicar en Shopify” está ON, también sincroniza existencias en Shopify usando las bodegas configuradas en “Inventario y bodegas”.">?</span></label>
		                              <input type="checkbox" id="products-sync-include-inventory" class="toggle" checked />
		                            </div>
	                          </div>
	                          <div class="mode-actions">
	                            <button class="primary" id="products-sync-filtered" type="button">Sincronizar masivo</button>
		                            <button class="ghost danger" id="products-sync-stop" type="button" hidden>Detener</button>
		                            <button class="ghost" id="products-sync-clear" type="button">Limpiar</button>
		                            <span class="kpi-sub" id="products-sync-status">Sin datos</span>
		                          </div>
		                          <div class="sync-progress" id="products-sync-progress" aria-hidden="true">
		                            <div class="sync-progress-track">
		                              <div class="sync-progress-bar" id="products-sync-progress-bar"></div>
		                            </div>
		                            <span class="sync-progress-label" id="products-sync-progress-label">Sincronizando 0%</span>
		                          </div>
		                        </div>

						                        <div class="mode-section">
							                          <div class="mode-head">
							                            <div class="mode-head-left">
							                              <label class="mode-title-toggle" for="rules-auto-enabled" data-dep-controller="1">
							                                <input type="checkbox" id="rules-auto-enabled" class="toggle" data-dep-controller="1" checked />
								                                <span>Automático: productos Alegra → Shopify</span>
								                              </label>
										                              <span class="tip" data-tip="Se ejecuta sola cuando llegan cambios desde Alegra. Estas reglas también aplican cuando sincronizas manualmente desde el módulo Productos. Si apagas “Publicar en Shopify”, el sistema solo actualiza datos y no deja productos visibles.">?</span>
									                            </div>
									                          </div>
										                          <div class="mode-toggle-grid" aria-label="Opciones automático (Alegra → Shopify)" data-depends-on="rules-auto-enabled">
									                            <div class="mode-toggle">
									                              <label for="rules-auto-create-shopify">Crear nuevos en Shopify <span class="tip" data-tip="Si está OFF, no creamos productos nuevos en Shopify. Solo actualizamos los que ya existan/mapeados.">?</span></label>
								                              <input type="checkbox" id="rules-auto-create-shopify" class="toggle" data-depends-on="rules-auto-enabled" checked />
									                            </div>
									                            <div class="mode-toggle">
									                              <label for="rules-auto-update-shopify">Actualizar existentes en Shopify <span class="tip" data-tip="Si está OFF, no modificamos productos existentes (precio/stock/estado). Igual se registran en la base para que los veas en Productos.">?</span></label>
								                              <input type="checkbox" id="rules-auto-update-shopify" class="toggle" data-depends-on="rules-auto-enabled" checked />
									                            </div>
									                            <div class="mode-toggle">
									                              <label for="rules-only-active">Solo activos en Alegra <span class="tip" data-tip="Si está activo, solo se sincronizan productos activos en Alegra (automático y manual por SKU).">?</span></label>
								                              <input type="checkbox" id="rules-only-active" class="toggle" />
									                            </div>
						                            <div class="mode-toggle">
						                              <label for="rules-auto-publish">Publicar en Shopify <span class="tip" data-tip="Enciende/apaga la publicación. Si lo apagas, solo sincronizamos datos, pero no publicamos productos (automático ni manual por SKU).">?</span></label>
						                              <input type="checkbox" id="rules-auto-publish" class="toggle" />
						                            </div>
									                            <div class="mode-toggle">
									                              <label for="rules-auto-images">Publicar fotos <span class="tip" data-tip="Si está activo, intentamos subir fotos del producto a Shopify. Si una foto falla, el producto puede publicarse igual (solo quedará sin esa foto).">?</span></label>
									                              <input type="checkbox" id="rules-auto-images" class="toggle" data-depends-on="rules-auto-publish" />
									                            </div>
						                            <div class="mode-toggle">
						                              <label for="rules-auto-status">Estado <span class="tip" data-tip="Define el estado de publicación cuando “Publicar en Shopify” está activo: Borrador o Activo.">?</span></label>
						                              <select id="rules-auto-status" data-depends-on="rules-auto-publish">
						                                <option value="draft">Borrador</option>
						                                <option value="active">Activo</option>
						                              </select>
						        </div>
	                      </div>
		                      <p class="field-hint module-warning is-hidden" data-module-warning="shopify-rules"></p>
		                    </div>
		                  </div>

		                  <div class="panel admin-only module" data-provider="bridge" data-manager="shopify" data-module="shopify-products-to-alegra" data-module-priority="core" id="shopify-products-to-alegra-panel" data-help="Bidireccionalidad de Productos (Shopify → Alegra): crea/actualiza ítems en Alegra desde productos y variantes de Shopify. Masivo = catálogo inicial o re-procesar un rango por fechas. Automático = se ejecuta con webhooks de Shopify (products/create y products/update).">
		                    <div class="panel-header">
			                      <h3 data-module-toggle="shopify-products-to-alegra" data-title-base="Sincronizar productos (Shopify → Alegra)">
			                        Sincronizar productos (Shopify → Alegra)
			                        <span class="tip" data-tip="Sincroniza productos y variantes desde Shopify hacia Alegra. Tip: prueba primero con “Crear en Alegra” apagado para validar match por SKU/Barcode.">?</span>
			                      </h3>
		                      <div class="panel-meta">
		                        <span class="panel-tag tag-core">Core</span>
		                        <span class="panel-tag tag-bridge">Shopify → Alegra</span>
		                      </div>
		                    </div>
		                    <div class="module-body">
		                      <div class="mode-sections">
		                        <div class="mode-section" data-readonly-free="1">
		                          <div class="mode-head">
		                            <div class="mode-head-left">
			                              <h4>Masivo: productos Shopify → Alegra</h4>
			                              <span class="tip" data-tip="Trae productos de Shopify por fechas y sincroniza cada variante como un ítem en Alegra. Si no hay match por SKU/Barcode, puedes permitir crear. Si incluyes inventario, se ajusta el stock en la bodega seleccionada.">?</span>
		                            </div>
		                          </div>
		                          <div class="mode-grid">
		                            <div class="mode-field">
		                              <label for="products-shopify-bulk-date-start">Fecha inicio</label>
		                              <input type="date" id="products-shopify-bulk-date-start" />
		                            </div>
		                            <div class="mode-field">
		                              <label for="products-shopify-bulk-date-end">Fecha fin</label>
		                              <input type="date" id="products-shopify-bulk-date-end" />
		                            </div>
		                            <div class="mode-field">
		                              <label for="products-shopify-bulk-limit">Limite (opcional)</label>
		                              <input type="number" id="products-shopify-bulk-limit" min="1" placeholder="200" />
		                            </div>
		                          </div>
		                          <div class="mode-toggle-grid" aria-label="Opciones masivo productos Shopify → Alegra">
		                            <div class="mode-toggle">
					                              <label for="products-shopify-bulk-create">Crear nuevos en Alegra <span class="tip" data-tip="Si está OFF, solo actualizamos existentes (por mapping o match). Si está ON, creamos ítems en Alegra cuando no existen.">?</span></label>
					                              <input type="checkbox" id="products-shopify-bulk-create" class="toggle" />
					                            </div>
					                            <div class="mode-toggle">
					                              <label for="products-shopify-bulk-update">Actualizar existentes en Alegra <span class="tip" data-tip="Si está OFF, no modificamos ítems existentes; solo intentamos mapear/matchear. Recomendado: ON.">?</span></label>
					                              <input type="checkbox" id="products-shopify-bulk-update" class="toggle" checked />
					                            </div>
		                            <div class="mode-toggle">
		                              <label for="products-shopify-bulk-include-inventory">Incluir inventario <span class="tip" data-tip="Si está ON, ajustamos el stock en Alegra para la bodega seleccionada usando el inventario total de Shopify.">?</span></label>
		                              <input type="checkbox" id="products-shopify-bulk-include-inventory" class="toggle" />
		                            </div>
		                            <div class="mode-toggle">
		                              <label for="products-shopify-bulk-match">Prioridad de identificación <span class="tip" data-tip="Antes de crear, buscamos el ítem en Alegra con esta prioridad. Si encontramos match, actualizamos (evita duplicados).">?</span></label>
		                              <select id="products-shopify-bulk-match">
		                                <option value="sku_barcode" selected>SKU → Barcode</option>
		                                <option value="barcode_sku">Barcode → SKU</option>
		                              </select>
		                            </div>
		                            <div class="mode-toggle">
		                              <label for="products-shopify-bulk-warehouse">Bodega destino (stock) <span class="tip" data-tip="Obligatoria si “Incluir inventario” está ON. Debe existir en Alegra (Configuración → Conexiones).">?</span></label>
		                              <select id="products-shopify-bulk-warehouse" data-allow-empty="true" data-empty-label="Seleccionar..." data-depends-on="products-shopify-bulk-include-inventory"></select>
		                            </div>
		                          </div>
		                          <div class="mode-actions">
		                            <button class="primary" id="products-shopify-bulk-run" type="button">Sincronizar masivo</button>
		                            <button class="ghost danger" id="products-shopify-bulk-stop" type="button" hidden>Detener</button>
		                            <button class="ghost" id="products-shopify-bulk-clear" type="button">Limpiar</button>
		                            <span class="kpi-sub" id="products-shopify-bulk-status">Sin datos</span>
		                          </div>
		                          <div class="sync-progress" id="products-shopify-bulk-progress" aria-hidden="true">
		                            <div class="sync-progress-track">
		                              <div class="sync-progress-bar" id="products-shopify-bulk-progress-bar"></div>
		                            </div>
		                            <span class="sync-progress-label" id="products-shopify-bulk-progress-label">Sincronizando 0%</span>
		                          </div>
		                        </div>

		                        <div class="mode-section">
		                          <div class="mode-head">
		                            <div class="mode-head-left">
		                              <label class="mode-title-toggle" for="cfg-products-shopify-to-alegra-enabled" data-dep-controller="1">
		                                <input type="checkbox" id="cfg-products-shopify-to-alegra-enabled" class="toggle" data-dep-controller="1" />
			                                <span>Automático: productos Shopify → Alegra</span>
			                              </label>
		                              <span class="tip" data-tip="ON: cuando llega un webhook de Shopify (products/create o products/update), actualizamos/creamos el ítem en Alegra según las opciones.">?</span>
		                            </div>
		                          </div>
		                          <div class="mode-toggle-grid" aria-label="Opciones automatico productos Shopify → Alegra" data-depends-on="cfg-products-shopify-to-alegra-enabled">
		                            <div class="mode-toggle">
			                              <label for="cfg-products-shopify-to-alegra-create">Crear nuevos en Alegra</label>
			                              <input type="checkbox" id="cfg-products-shopify-to-alegra-create" class="toggle" data-depends-on="cfg-products-shopify-to-alegra-enabled" />
			                            </div>
			                            <div class="mode-toggle">
			                              <label for="cfg-products-shopify-to-alegra-update">Actualizar existentes en Alegra</label>
			                              <input type="checkbox" id="cfg-products-shopify-to-alegra-update" class="toggle" data-depends-on="cfg-products-shopify-to-alegra-enabled" checked />
			                            </div>
		                            <div class="mode-toggle">
		                              <label for="cfg-products-shopify-to-alegra-include-inventory">Incluir inventario</label>
		                              <input type="checkbox" id="cfg-products-shopify-to-alegra-include-inventory" class="toggle" data-depends-on="cfg-products-shopify-to-alegra-enabled" />
		                            </div>
		                            <div class="mode-toggle">
		                              <label for="cfg-products-shopify-to-alegra-match">Prioridad de identificación</label>
		                              <select id="cfg-products-shopify-to-alegra-match" data-depends-on="cfg-products-shopify-to-alegra-enabled">
		                                <option value="sku_barcode" selected>SKU → Barcode</option>
		                                <option value="barcode_sku">Barcode → SKU</option>
		                              </select>
		                            </div>
		                            <div class="mode-toggle">
		                              <label for="cfg-products-shopify-to-alegra-warehouse">Bodega destino (stock) <span class="tip" data-tip="Obligatoria si “Incluir inventario” está ON. Debe existir en Alegra.">?</span></label>
		                              <select id="cfg-products-shopify-to-alegra-warehouse" data-allow-empty="true" data-empty-label="Seleccionar..." data-depends-on="cfg-products-shopify-to-alegra-include-inventory"></select>
		                            </div>
		                          </div>
		                        </div>
		                      </div>
		                      <p class="field-hint module-warning is-hidden" data-module-warning="shopify-products-to-alegra"></p>
		                    </div>
		                  </div>

				                  <div class="panel admin-only module" data-provider="bridge" data-manager="alegra" data-module="alegra-inventory" id="inventory-rules-panel" data-help="Inventario automatico por tienda: define de que bodegas se toma el stock y si lo mantenemos actualizado en Shopify.">
			                    <div class="panel-header">
				                      <h3 data-module-toggle="alegra-inventory" data-title-base="Sincronizar inventario (Alegra → Shopify)">
				                        Sincronizar inventario (Alegra → Shopify)
			                        <span class="tip" data-tip="Mantiene el stock al día en Shopify: corre solo cada cierto tiempo y actualiza existencias usando las bodegas de Alegra que elijas.">?</span>
			                      </h3>
		                      <div class="panel-meta">
		                        <span class="panel-tag tag-bridge">Alegra → Shopify</span>
	                      </div>
	                    </div>
                    <div class="module-body">
			                      <div class="mode-sections">
						                        <div class="mode-section" data-readonly-free="1">
						                          <div class="mode-head">
								                            <div class="mode-head-left">
								                              <label class="mode-title-toggle" for="inventory-cron-enabled" data-dep-controller="1">
								                                <input type="checkbox" id="inventory-cron-enabled" class="toggle" data-dep-controller="1" />
									                                <span>Automático: inventario Alegra → Shopify</span>
									                              </label>
								                              <span class="tip" data-tip="Prende o apaga la automatización de inventario, define cada cuánto consultar y de qué bodegas tomar el stock.">?</span>
								                            </div>
							                          </div>
						                          <div class="mode-toggle-grid" aria-label="Opciones de inventario" data-depends-on="inventory-cron-enabled">
					                            <div class="mode-toggle">
					                              <label for="inventory-cron-interval-select">Cada cuánto consultar</label>
					                              <select id="inventory-cron-interval-select" data-depends-on="inventory-cron-enabled">
				                                <option value="5">Cada 5 minutos</option>
			                                <option value="10">Cada 10 minutos</option>
			                                <option value="15">Cada 15 minutos</option>
			                              </select>
				                            </div>
				                            <div class="mode-toggle">
				                              <label for="cfg-inventory-warehouses">Bodegas para stock (masivo y automático) <span class="tip" data-tip="Estas bodegas se usan para calcular existencias cuando sincronizamos inventario y también para filtrar/calcular stock cuando sincronizamos productos (masivo y automático).">?</span></label>
				                              <details class="multi-select" data-depends-on="inventory-cron-enabled">
			                                <summary>
			                                  <span>Seleccionar bodegas</span>
			                                  <em id="cfg-inventory-warehouses-summary">Todas</em>
			                                </summary>
			                                <div class="checkbox-grid single" id="cfg-inventory-warehouses"></div>
			                              </details>
				                            </div>
			                            <div class="mode-toggle">
			                              <label for="rules-sync-enabled">Sincronizar inventario en Shopify <span class="tip" data-tip="Si lo apagas, el sistema no actualizará existencias en Shopify (ni en masivo ni en automático).">?</span></label>
			                              <input type="checkbox" id="rules-sync-enabled" class="toggle" />
			                            </div>
			                          </div>
			                          <div class="mode-actions" aria-label="Estado de automatización">
			                            <span class="kpi-sub">
			                              <span class="status-led" id="inventory-cron-led"></span>
			                              <strong>Estado:</strong> <span id="inventory-cron-status">Sin datos</span>
			                            </span>
			                            <span class="kpi-sub"><strong>Última actualización:</strong> <span id="inventory-cron-checkpoint">-</span></span>
			                            <span class="kpi-sub"><strong>Intervalo actual:</strong> <span id="inventory-cron-interval">-</span></span>
			                          </div>
			                        </div>
			                      </div>
			                      <p class="field-hint module-warning is-hidden" data-module-warning="alegra-inventory"></p>
			                    </div>
			                  </div>

		                </div>
		              </div>
		              <div class="settings-group provider-group" data-group="contacts">
	                <div class="settings-group-header" data-group-toggle="contacts">
	                  <h4 class="group-title">
	                    <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
	                    <span class="group-arrow">↔</span>
	                    <img class="provider-logo" src="/brands/alegra.png?v=20260201s" alt="Alegra" />
	                    Contactos
	                  </h4>
	                </div>
	                <div class="settings-group-body">
			                  <div class="panel admin-only module" data-provider="bridge" data-manager="shopify" data-module="sync-contacts" data-module-priority="core" data-help="Modulo principal de Contactos: define como se identifican y sincronizan clientes entre Shopify y Alegra. Incluye masivo y automático.">
		                    <div class="panel-header">
				                      <h3 data-module-toggle="sync-contacts" data-title-base="Sincronizar contactos (Shopify ↔ Alegra)">
				                        Sincronizar contactos (Shopify ↔ Alegra)
					                        <span class="tip" data-tip="Sincroniza clientes entre Shopify y Alegra. Para evitar duplicados: define la “Prioridad de identificación” y prueba primero con los toggles de “Crear” apagados.">?</span>
				                      </h3>
	                      <div class="panel-meta">
	                        <span class="panel-tag tag-core">Core</span>
	                        <span class="panel-tag tag-bridge">Alegra ↔ Shopify</span>
	                      </div>
	                    </div>
	                    <div class="module-body">
		                      <div class="mode-sections">
				                        <div class="mode-section" data-readonly-free="1">
				                          <div class="mode-head">
							                            <h4>Masivo: contactos Shopify ↔ Alegra</h4>
							                            <span class="tip" data-tip="Crea/normaliza contactos en lote. Puedes correr una dirección o ambas (bidireccional); si activas ambas se ejecuta en 2 fases. Tip anti-duplicados: define la prioridad y prueba primero con “Crear” apagado.">?</span>
					                          </div>
				                          <div class="mode-grid">
			                            <div class="mode-field">
			                              <label for="sync-contacts-bulk-date-start">Fecha inicio</label>
			                              <input type="date" id="sync-contacts-bulk-date-start" />
			                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contacts-bulk-date-end">Fecha fin</label>
		                              <input type="date" id="sync-contacts-bulk-date-end" />
		                            </div>
			                            <div class="mode-field">
			                              <label for="sync-contact-limit">Limite (opcional)</label>
			                              <input type="number" id="sync-contact-limit" min="1" placeholder="200" />
			                            </div>
			                          </div>
				                          <div class="mode-toggle-grid" aria-label="Direcciones masivo">
				                            <div class="mode-toggle">
					                              <label for="sync-contacts-bulk-shopify">Permitir Shopify → Alegra <span class="tip" data-tip="Trae contactos desde Shopify (según fechas) y los actualiza/crea en Alegra.">?</span></label>
					                              <input type="checkbox" id="sync-contacts-bulk-shopify" class="toggle" checked />
				                            </div>
				                            <div class="mode-toggle">
					                              <label for="sync-contacts-bulk-create-alegra">Crear nuevos en Alegra <span class="tip" data-tip="Solo aplica a Shopify → Alegra. ON: si no existe en Alegra, lo creamos. OFF: solo actualizamos existentes (sin crear nuevos).">?</span></label>
					                              <input type="checkbox" id="sync-contacts-bulk-create-alegra" class="toggle" data-depends-on="sync-contacts-bulk-shopify" checked />
				                            </div>
				                            <div class="mode-toggle">
					                              <label for="sync-contacts-bulk-alegra">Permitir Alegra → Shopify <span class="tip" data-tip="Trae contactos desde Alegra (según fechas) y los actualiza/crea en Shopify.">?</span></label>
					                              <input type="checkbox" id="sync-contacts-bulk-alegra" class="toggle" checked />
				                            </div>
				                            <div class="mode-toggle">
					                              <label for="sync-contacts-bulk-create-shopify">Crear nuevos en Shopify <span class="tip" data-tip="Solo aplica a Alegra → Shopify. ON: si no existe en Shopify, lo creamos. OFF: solo actualizamos existentes (sin crear nuevos).">?</span></label>
					                              <input type="checkbox" id="sync-contacts-bulk-create-shopify" class="toggle" data-depends-on="sync-contacts-bulk-alegra" checked />
				                            </div>
				                          </div>
				                          <div class="mode-actions">
				                            <button class="primary" id="sync-contacts-bulk-run" type="button">Sincronizar masivo</button>
				                            <button class="ghost danger" id="sync-contacts-bulk-stop" type="button" hidden>Detener</button>
				                            <button class="ghost" id="sync-contacts-bulk-clear" type="button">Limpiar</button>
				                            <span class="kpi-sub" id="sync-contacts-status">Sin datos</span>
				                          </div>
				                          <div class="sync-progress" id="contacts-sync-progress" aria-hidden="true">
				                            <div class="sync-progress-track">
				                              <div class="sync-progress-bar" id="contacts-sync-progress-bar"></div>
				                            </div>
				                            <span class="sync-progress-label" id="contacts-sync-progress-label">Sincronizando 0%</span>
				                          </div>
				                        </div>

						                        <div class="mode-section">
						                          <div class="mode-head">
						                            <div class="mode-head-left">
						                              <label class="mode-title-toggle" for="sync-contacts-enabled" data-dep-controller="1">
						                                <input type="checkbox" id="sync-contacts-enabled" class="toggle" data-dep-controller="1" checked />
							                                <span>Automático: contactos Shopify ↔ Alegra</span>
							                              </label>
								                              <span class="tip" data-tip="Define qué direcciones están permitidas en automático. Nota: el masivo usa los toggles de arriba (dirección + crear).">?</span>
						                            </div>
						                          </div>
						                          <div class="mode-grid" data-depends-on="sync-contacts-enabled">
					                            <div class="mode-field">
						                              <label for="sync-contacts-shopify">Permitir Shopify → Alegra <span class="tip" data-tip="Permite que el sistema sincronice automáticamente desde Shopify hacia Alegra.">?</span></label>
						                              <input type="checkbox" id="sync-contacts-shopify" class="toggle" checked />
				                            </div>
			                            <div class="mode-field">
					                              <label for="sync-contacts-create-alegra">Crear nuevos en Alegra <span class="tip" data-tip="En automático, permite crear nuevos contactos en Alegra cuando no existen. Si lo apagas, solo se actualizan existentes.">?</span></label>
				                              <input type="checkbox" id="sync-contacts-create-alegra" class="toggle" data-depends-on="sync-contacts-shopify" checked />
			                            </div>
			                            <div class="mode-field">
				                              <label for="sync-contacts-alegra">Permitir Alegra → Shopify <span class="tip" data-tip="Permite que el sistema sincronice automáticamente desde Alegra hacia Shopify.">?</span></label>
				                              <input type="checkbox" id="sync-contacts-alegra" class="toggle" checked />
			                            </div>
			                            <div class="mode-field">
					                              <label for="sync-contacts-create-shopify">Crear nuevos en Shopify <span class="tip" data-tip="En automático, permite crear nuevos clientes en Shopify cuando no existen. Si lo apagas, solo se actualizan existentes.">?</span></label>
				                              <input type="checkbox" id="sync-contacts-create-shopify" class="toggle" data-depends-on="sync-contacts-alegra" checked />
			                            </div>
			                            <div class="mode-field">
				                              <label for="sync-contacts-priority">Prioridad de identificación <span class="tip" data-tip="Antes de crear, buscamos el contacto en el destino usando este orden. Si encontramos match, actualizamos (evita duplicados). Recomendación: si el Documento es confiable, ponlo primero.">?</span></label>
			                              <select id="sync-contacts-priority">
			                                <option value="document_phone_email">Documento → Teléfono → Email</option>
			                                <option value="email_document_phone">Email → Documento → Teléfono</option>
		                                <option value="phone_document_email">Teléfono → Documento → Email</option>
		                              </select>
		                            </div>
		                          </div>
		                        </div>
		                      </div>
			                      <p class="field-hint module-warning is-hidden" data-module-warning="sync-contacts"></p>
			                    </div>
			                  </div>
	                </div>
	              </div>

	              <div class="settings-group provider-group" data-group="orders">
	                <div class="settings-group-header" data-group-toggle="orders">
	                  <h4 class="group-title">
	                    <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
	                    <span class="group-arrow">↔</span>
	                    <img class="provider-logo" src="/brands/alegra.png?v=20260201s" alt="Alegra" />
		                    Pedidos y facturación
	                  </h4>
	                </div>
	                <div class="settings-group-body">
	                  <div class="panel admin-only module" data-provider="bridge" data-manager="shopify" data-module="sync-orders" data-module-priority="core" data-help="Modulo principal de Pedidos: define como se sincronizan pedidos entre Shopify y Alegra. Incluye automatico (se sincroniza solo), masivo (inicio) y acciones manuales por pedido.">
	                    <div class="panel-header">
			                      <h3 data-module-toggle="sync-orders" data-title-base="Pedidos (Shopify → Alegra) y facturas (Alegra → Shopify)">
			                        Pedidos (Shopify → Alegra) y facturas (Alegra → Shopify)
	                        <span class="tip" data-tip="Aquí controlas las 2 direcciones:&#10;1) Pedidos: Shopify → Alegra (registrar / crear factura).&#10;2) Facturas: Alegra → Shopify (crear pedido/draft).&#10;Recomendación: prueba primero en masivo con rangos cortos.">?</span>
	                      </h3>
                      <div class="panel-meta">
                        <span class="panel-tag tag-core">Core</span>
                        <span class="panel-tag tag-bridge">Shopify ↔ Alegra</span>
                      </div>
                    </div>
		                    <div class="module-body">
			                      <div class="mode-sections">
			                        <div class="mode-section" data-readonly-free="1">
			                          <div class="mode-head">
			                            <div class="mode-head-left">
				                              <h4>Sincronizar pedidos de Shopify a Alegra (masivo)</h4>
		                              <span class="tip" data-tip="Trae pedidos de Shopify por fechas o por número. Siempre los registramos en la base.&#10;Si en Automático tienes “Crear factura” ON, también intentará facturarlos en Alegra.&#10;Tip: usa un rango corto para validar.">?</span>
	                            </div>
	                          </div>
	                          <div class="mode-grid">
	                            <div class="mode-field">
	                              <label for="orders-sync-date-start">Fecha inicio</label>
	                              <input type="date" id="orders-sync-date-start" />
	                            </div>
	                            <div class="mode-field">
	                              <label for="orders-sync-date-end">Fecha fin</label>
	                              <input type="date" id="orders-sync-date-end" />
	                            </div>
	                            <div class="mode-field">
	                              <label for="orders-sync-limit">Limite (opcional)</label>
	                              <input type="number" id="orders-sync-limit" min="1" placeholder="200" />
	                            </div>
		                            <input type="hidden" id="orders-sync-number" value="" />
	                          </div>
	                          <div class="mode-actions">
	                            <button class="primary" id="orders-sync" type="button">Sincronizar masivo</button>
	                            <button class="ghost danger" id="orders-sync-stop" type="button" hidden>Detener</button>
	                            <button class="ghost" id="orders-sync-clear" type="button">Limpiar</button>
	                            <span class="kpi-sub" id="orders-sync-status">Sin datos</span>
	                          </div>
		                          <div class="sync-progress" id="orders-sync-progress" aria-hidden="true">
		                            <div class="sync-progress-track">
		                              <div class="sync-progress-bar" id="orders-sync-progress-bar"></div>
		                            </div>
		                            <span class="sync-progress-label" id="orders-sync-progress-label">Sincronizando 0%</span>
		                          </div>
		                        </div>

							                        <div class="mode-section">
								                          <div class="mode-head">
								                            <div class="mode-head-left">
							                              <label class="mode-title-toggle" for="sync-orders-shopify-enabled" data-dep-controller="1">
							                                <input type="checkbox" id="sync-orders-shopify-enabled" class="toggle" data-dep-controller="1" />
								                                <span>Automático: pedidos Shopify → Alegra</span>
								                              </label>
									                              <span class="tip" data-tip="ON: procesa pedidos nuevos en tiempo real (webhooks).&#10;OFF: no se detectan pedidos nuevos automáticamente.">?</span>
							                            </div>
							                          </div>
								                          <div class="mode-toggle-grid" aria-label="Opciones automatico pedidos" data-depends-on="sync-orders-shopify-enabled">
								                            <div class="mode-toggle">
								                              <label for="sync-orders-shopify-invoice">Crear factura <span class="tip" data-tip="Si está ON, se crea la factura usando Logistica/Traslados + Facturacion. Si está OFF, solo registramos el pedido en la base.">?</span></label>
								                              <input type="checkbox" id="sync-orders-shopify-invoice" class="toggle" data-depends-on="sync-orders-shopify-enabled" />
								                            </div>
								                          </div>
								                          <div class="mode-actions" aria-label="Estado webhooks Shopify">
								                            <span class="kpi-sub"><strong>Webhooks:</strong> <span id="shopify-webhooks-status">Sin configurar</span></span>
								                          </div>
							                          <select id="sync-orders-shopify" hidden aria-hidden="true" tabindex="-1">
							                            <option value="db_only">Solo registrar</option>
							                            <option value="invoice">Crear factura</option>
							                            <option value="off">No sincronizar</option>
							                          </select>
							                        </div>

			                        <div class="mode-section" data-readonly-free="1">
			                          <div class="mode-head">
				                            <div class="mode-head-left">
				                              <h4>Sincronizar facturas de Alegra a Shopify (masivo)</h4>
		                              <span class="tip" data-tip="Paso 1: decide si quieres crear el pedido en Shopify o solo cargar las facturas a la base (para verlas en Facturas).&#10;Paso 2 (opcional): si activas “Crear pedido”, elige Borrador o Activo.&#10;Tip: si el item está mapeado (Alegra ↔ Shopify), se usa la variante; si no, se crea una línea personalizada.">?</span>
		                            </div>
	                          </div>
	                          <div class="mode-toggle-grid" aria-label="Accion masiva facturas">
	                            <div class="mode-toggle">
	                              <label for="invoices-backfill-create-shopify">Crear pedido en Shopify <span class="tip" data-tip="OFF: solo cargamos facturas a la base. ON: creamos pedidos/borradores en Shopify (según “Crear como”).">?</span></label>
	                              <input type="checkbox" id="invoices-backfill-create-shopify" class="toggle" />
	                            </div>
	                            <div class="mode-toggle" id="invoices-backfill-mode-field" hidden>
	                              <label for="invoices-backfill-mode">Crear como <span class="tip" data-tip="Borrador (Draft): se crea como borrador, no queda visible para clientes.&#10;Activo (Order): se crea como pedido activo en Shopify.&#10;Solo aplica si “Crear pedido en Shopify” está ON.">?</span></label>
	                              <select id="invoices-backfill-mode">
	                                <option value="draft" selected>Borrador (Draft)</option>
	                                <option value="active">Activo (Order)</option>
	                              </select>
	                            </div>
	                          </div>
	                          <div class="mode-grid">
	                            <div class="mode-field">
	                              <label for="invoices-backfill-date-start">Fecha inicio</label>
	                              <input type="date" id="invoices-backfill-date-start" />
	                            </div>
	                            <div class="mode-field">
	                              <label for="invoices-backfill-date-end">Fecha fin</label>
	                              <input type="date" id="invoices-backfill-date-end" />
	                            </div>
	                            <div class="mode-field">
	                              <label for="invoices-backfill-limit">Limite (recomendado)</label>
	                              <input type="number" id="invoices-backfill-limit" min="1" placeholder="200" />
	                            </div>
	                          </div>
	                          <div class="mode-actions">
	                            <button class="primary" id="invoices-backfill-run" type="button">Cargar facturas</button>
	                            <button class="ghost danger" id="invoices-backfill-stop" type="button" hidden>Detener</button>
	                            <button class="ghost" id="invoices-backfill-clear" type="button">Limpiar</button>
	                            <span class="kpi-sub" id="invoices-backfill-status">Sin datos</span>
	                          </div>
		                          <div class="sync-progress" id="invoices-backfill-progress" aria-hidden="true">
		                            <div class="sync-progress-track">
		                              <div class="sync-progress-bar" id="invoices-backfill-progress-bar"></div>
		                            </div>
		                            <span class="sync-progress-label" id="invoices-backfill-progress-label">Sincronizando 0%</span>
		                          </div>
		                        </div>

							                        <div class="mode-section">
							                          <div class="mode-head">
							                            <div class="mode-head-left">
							                              <label class="mode-title-toggle" for="sync-orders-alegra-enabled" data-dep-controller="1">
							                                <input type="checkbox" id="sync-orders-alegra-enabled" class="toggle" data-dep-controller="1" />
								                                <span>Automático: facturas Alegra → Shopify</span>
								                              </label>
								                              <span class="tip" data-tip="ON: cuando llega un webhook de factura desde Alegra, creamos el pedido en Shopify según el modo seleccionado.&#10;Recomendado: configurar el webhook como /api/webhooks/alegra?shopDomain=tu-tienda.myshopify.com.">?</span>
							                            </div>
							                          </div>
							                          <div class="mode-grid" id="sync-orders-alegra-mode-field" hidden>
							                            <div class="mode-field">
							                              <label for="sync-orders-alegra">Crear pedido como</label>
							                              <select id="sync-orders-alegra">
							                                <option value="off" selected>Apagado</option>
							                                <option value="draft">Borrador (Draft)</option>
							                                <option value="active">Activo (Order)</option>
							                              </select>
							                            </div>
							                          </div>
							                        </div>
			                      </div>
		                      <p class="field-hint module-warning is-hidden" data-module-warning="sync-orders"></p>
		                    </div>
		                  </div>

				                  <div class="panel admin-only module" data-provider="alegra" data-manager="shopify" data-module="alegra-logistics" id="inventory-transfer-panel" data-help="Configura el traslado de inventario que se ejecuta automaticamente antes de facturar pedidos (Shopify → Alegra).">
            <div class="panel-header">
	              <h3 data-module-toggle="alegra-logistics" data-title-base="Logística (Alegra) para facturar pedidos">Logística (Alegra) para facturar pedidos</h3>

            </div>
            <div class="module-body">
              <div class="mode-sections">
                <div class="mode-section">
                  <div class="mode-head">
                    <div class="mode-head-left">
                      <label class="mode-title-toggle" for="cfg-transfer-enabled" data-dep-controller="1">
                        <input type="checkbox" id="cfg-transfer-enabled" class="toggle" data-dep-controller="1" />
                        <span>Traslado de inventario</span>
                      </label>
                      <span class="tip" data-tip="Define de qué bodegas sale la mercancía y a qué bodega llega antes de crear la factura. Se ejecuta automáticamente cuando Pedidos → Crear factura está activo.">?</span>
                    </div>
                  </div>

		                  <div class="mode-grid" data-depends-on="cfg-transfer-enabled">
			                    <div class="field mode-field">
			                      <label>Tipo de bodega destino <span class="tip" data-tip="Automática: usa Bodega prioritaria (o la primera disponible) como destino. Fija (HUB): usa la bodega seleccionada aquí. Por regla: disponible próximamente.">?</span></label>
			                      <select id="cfg-transfer-dest-mode" data-depends-on="cfg-transfer-enabled">
			                        <option value="fixed">Fija (HUB)</option>
			                        <option value="auto">Automática</option>
			                        <option value="rule">Por regla</option>
			                      </select>
			                    </div>
		                    <div class="field mode-field">
		                      <label>Bodega destino (HUB) <span class="tip" data-tip="Bodega destino donde queda el inventario listo para facturar y ajustar stock. Solo aplica cuando el tipo de destino es Fija (HUB).">?</span></label>
		                      <select id="cfg-transfer-dest" data-depends-on="cfg-transfer-enabled"></select>
		                    </div>
			                    <div class="field mode-field">
			                      <label for="cfg-transfer-dest-required">Destino requerido <span class="tip" data-tip="Si está ON, el sistema no puede crear factura si no hay un destino definido.">?</span></label>
			                      <input type="checkbox" id="cfg-transfer-dest-required" class="toggle" data-depends-on="cfg-transfer-enabled" checked />
			                    </div>
		                    <div class="field mode-field">
		                      <label>Estrategia principal</label>
		                      <select id="cfg-transfer-strategy" data-depends-on="cfg-transfer-enabled">
		                        <option value="manual">Manual (sin estrategia)</option>
		                        <option value="consolidation">Consolidacion</option>
		                        <option value="priority">Prioridad</option>
		                        <option value="max_stock">Mayor existencia</option>
		                      </select>
		                    </div>
		                    <div class="field mode-field field-span" id="cfg-transfer-origin-field" data-depends-on="cfg-transfer-enabled">
		                      <label>Bodegas origen <span class="tip" data-tip="Bodegas de donde puede salir la mercancía. Si eliges estrategia Manual, debes seleccionar al menos 1.">?</span></label>
		                      <details class="multi-select" data-depends-on="cfg-transfer-enabled">
		                        <summary>
		                          <span>Seleccionar bodegas</span>
		                          <em id="cfg-transfer-origin-summary">Todas</em>
		                        </summary>
		                        <div class="checkbox-grid single" id="cfg-transfer-origin"></div>
		                      </details>
		                    </div>
		                    <div class="field mode-field">
		                      <label>Estrategia de respaldo</label>
		                      <select id="cfg-transfer-fallback" data-depends-on="cfg-transfer-enabled">
		                        <option value="">Ninguna</option>
                        <option value="manual">Manual (sin estrategia)</option>
                        <option value="consolidation">Consolidacion</option>
                        <option value="priority">Prioridad</option>
                        <option value="max_stock">Mayor existencia</option>
                      </select>
                    </div>
                    <div class="field mode-field">
                      <label>Desempate</label>
                      <select id="cfg-transfer-tiebreak" data-depends-on="cfg-transfer-enabled">
                        <option value="">Ninguno</option>
                        <option value="max_stock">Mayor existencia</option>
                        <option value="priority">Prioridad</option>
                        <option value="random">Aleatorio</option>
                      </select>
                    </div>
                    <div class="field mode-field">
                      <label>Bodega prioritaria</label>
                      <select id="cfg-transfer-priority" data-depends-on="cfg-transfer-enabled"></select>
                    </div>
                    <div class="field mode-field">
                      <label>Stock minimo por bodega</label>
                      <input type="number" id="cfg-transfer-min-stock" data-depends-on="cfg-transfer-enabled" min="0" step="1" placeholder="0" />
                    </div>
                  </div>

	                  <div class="mode-toggle-grid" aria-label="Opciones de traslado" data-depends-on="cfg-transfer-enabled">
	                    <div class="mode-toggle">
	                      <label for="cfg-transfer-split">Permitir dividir pedido <span class="tip" data-tip="Si un pedido tiene items en bodegas distintas, permite crear traslados por partes.">?</span></label>
	                      <input type="checkbox" id="cfg-transfer-split" class="toggle" data-depends-on="cfg-transfer-enabled" />
	                    </div>
	                  </div>
	                </div>
	              </div>
			              <p class="field-hint module-warning is-hidden" data-module-warning="alegra-logistics"></p>
			            </div>
			          </div>

			                  <div class="panel admin-only module" data-provider="alegra" data-manager="shopify" data-module="alegra-invoice" id="legacy-invoice-panel" data-help="Se usa cuando Shopify → Alegra = Factura. Define listas de precios y parametros de facturacion.">
	            <div class="panel-header">
	              <h3 data-module-toggle="alegra-invoice" data-title-base="Facturación en Alegra (para pedidos)">Facturación en Alegra (para pedidos)</h3>

	            </div>
	            <div class="module-body">
	              <div class="mode-sections">
	                <div class="mode-section">
	                  <div class="mode-head">
	                    <div class="mode-head-left">
	                      <label class="mode-title-toggle" for="cfg-price-enabled" data-dep-controller="1">
	                        <input type="checkbox" id="cfg-price-enabled" class="toggle" data-dep-controller="1" />
	                        <span>Listas de precios (opcional)</span>
	                      </label>
	                      <span class="tip" data-tip="Opcional. Si lo apagas o dejas vacío, se usa el precio base de Alegra.">?</span>
	                    </div>
	                  </div>
	                  <div class="mode-grid">
	                    <div class="field mode-field">
	                      <label>Lista para precio base</label>
	                      <select id="cfg-price-general" data-depends-on="cfg-price-enabled" data-allow-empty="true" data-empty-label="Usar precio base de Alegra"></select>
	                    </div>
	                    <div class="field mode-field">
	                      <label>Lista para descuentos</label>
	                      <select id="cfg-price-discount" data-depends-on="cfg-price-enabled" data-allow-empty="true" data-empty-label="No aplicar descuento"></select>
	                    </div>
	                    <div class="field mode-field">
	                      <label>Lista para mayoristas</label>
	                      <select id="cfg-price-wholesale" data-depends-on="cfg-price-enabled" data-allow-empty="true" data-empty-label="No aplicar mayorista"></select>
	                    </div>
	                    <div class="field mode-field">
	                      <label>Moneda</label>
	                      <select id="cfg-price-currency" data-depends-on="cfg-price-enabled">
	                        <option value="">Auto</option>
	                        <option value="COP">COP</option>
	                        <option value="USD">USD</option>
	                      </select>
	                    </div>
	                  </div>
	                </div>

		                <div class="mode-section">
		                  <div class="mode-head">
		                    <div class="mode-head-left">
		                      <h4>Reglas de facturación</h4>
		                      <span class="tip" data-tip="Estas reglas se usan cuando en Pedidos seleccionas “Crear factura”. La bodega se toma desde Logística e inventario (Bodega destino).">?</span>
		                    </div>
		                  </div>
				                  <div class="mode-grid">
			                    <div class="field is-toggle mode-field">
			                      <label>Factura electrónica (opcional) <span class="tip" data-tip="Actívala solo si necesitas capturar datos de factura electrónica por pedido (NIT/razón social, etc.). No bloquea la factura estándar.">?</span></label>
			                      <input type="checkbox" id="cfg-einvoice-enabled" class="toggle" />
			                    </div>
				                    <div class="field mode-field">
				                      <label>Tipo de factura</label>
				                      <select id="cfg-invoice-status">
				                        <option value="draft">Borrador</option>
			                        <option value="active">Activa</option>
			                      </select>
			                    </div>
				                    <div class="field mode-field" data-depends-on="cfg-einvoice-enabled">
					                      <label>Resolución DIAN <span class="tip" data-tip="Solo aplica si activas Factura electrónica.">?</span></label>
					                      <select id="cfg-resolution"></select>
				                    </div>
		                    <select id="cfg-warehouse" class="is-hidden"></select>
		                    <div class="field mode-field">
		                      <label>Centro de costos</label>
		                      <select id="cfg-cost-center"></select>
		                    </div>
		                    <div class="field mode-field">
		                      <label>Vendedor</label>
		                      <select id="cfg-seller"></select>
		                    </div>
		                    <div class="field mode-field">
		                      <label>Metodo de pago</label>
		                      <select id="cfg-payment-method" data-allow-empty="true" data-empty-label="No aplicar"></select>
		                    </div>
		                    <div class="field mode-field">
		                      <label>Cuenta bancaria</label>
		                      <select id="cfg-bank-account" data-depends-on="cfg-apply-payment" data-allow-empty="true" data-empty-label="No aplicar"></select>
		                      <p class="field-hint">Si aparecen "Sin datos", crea metodos de pago y cuentas en Alegra.</p>
		                    </div>
			                    <div class="field is-toggle mode-field">
			                      <label>Aplicar pago</label>
			                      <input type="checkbox" id="cfg-apply-payment" class="toggle" />
			                    </div>
			                    <div class="field mode-field">
			                      <label>Observaciones</label>
			                      <details class="multi-select" id="cfg-observations-fields">
			                        <summary>
			                          <span>Seleccionar campos</span>
			                          <em id="cfg-observations-fields-summary">Ninguno</em>
			                        </summary>
		                        <div class="checkbox-grid single" id="cfg-observations-fields-options">
		                          <label>
		                            <input type="checkbox" data-observation-key="order_name" data-observation-line="Pedido: {{order.name}}" />
		                            <span>Número de pedido</span>
		                          </label>
		                          <label>
		                            <input type="checkbox" data-observation-key="payment_gateways" data-observation-line="Pago (Shopify): {{order.payment_gateways}}" />
		                            <span>Tipo de pago (Shopify)</span>
		                          </label>
		                          <label>
		                            <input type="checkbox" data-observation-key="items_summary" data-observation-line="Productos: {{order.items_summary}}" />
		                            <span>Productos</span>
		                          </label>
		                          <label>
		                            <input type="checkbox" data-observation-key="customer_email" data-observation-line="Email: {{customer.email}}" />
		                            <span>Email</span>
		                          </label>
		                          <label>
		                            <input type="checkbox" data-observation-key="customer_phone" data-observation-line="Teléfono: {{customer.phone}}" />
		                            <span>Teléfono</span>
		                          </label>
		                          <label>
		                            <input type="checkbox" data-observation-key="order_total" data-observation-line="Total: {{order.total}} {{order.currency}}" />
		                            <span>Total</span>
		                          </label>
			                        </div>
			                      </details>
			                      <input type="text" id="cfg-observations-extra" placeholder="Texto adicional (opcional)" />
			                      <input type="hidden" id="cfg-observations" />
			                      <p class="field-hint" id="cfg-observations-preview">-</p>
			                    </div>
			                  </div>
			                  <p class="field-hint" id="cfg-store-message"></p>
			                </div>
		              </div>
	              <p class="field-hint module-warning is-hidden" data-module-warning="alegra-invoice"></p>
	            </div>
	                  </div>
                </div>
	            </div>
	          </div>
	        </div>


	        </div>

	        </section>
      </main>
    </div>

    <button class="assistant-launch" id="assistant-launch" type="button">Asistente</button>
    <div class="assistant-drawer" id="assistant-drawer" aria-hidden="true">
      <div class="panel assistant-panel">
        <div class="panel-header assistant-header">
          <div class="assistant-header-title">
            <div class="assistant-avatar-wrap">
              <img src="/assets/logo.png" alt="Apiflujos" class="assistant-avatar-badge" />
              <img src="/assets/avatar.png" alt="Olivia IA" class="assistant-avatar" />
            </div>
            <div class="assistant-title">
              <h3>Asistente IA</h3>
              <span class="assistant-byline">By apiflujos</span>
            </div>
          </div>
          <div class="assistant-header-actions">
            <span class="panel-tag">Olivia</span>
            <button class="ghost" id="assistant-close" type="button">Cerrar</button>
          </div>
        </div>
        <div class="assistant-messages" id="assistant-messages"></div>
        <div class="assistant-controls">
          <span class="assistant-hint">Enter para enviar · Ctrl+Enter para salto de linea</span>
        </div>
        <div class="assistant-input">
          <div class="assistant-attachments" id="assistant-attachments"></div>
          <div class="assistant-composer">
            <label class="ghost assistant-attach" id="assistant-attach" for="assistant-file" title="Adjuntar archivo">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M7 12l6-6a4 4 0 1 1 6 6l-8 8a6 6 0 0 1-8-8l9-9" />
              </svg>
            </label>
            <textarea id="assistant-input" rows="2" placeholder="Escribe una instruccion para Olivia IA..."></textarea>
            <button class="primary assistant-send" id="assistant-send" type="button" title="Enviar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M4 12l16-8-6 8 6 8-16-8z" />
              </svg>
            </button>
          </div>
          <input id="assistant-file" type="file" multiple accept="image/*,application/pdf" />
        </div>
      </div>
    </div>

    <div class="modal" id="payload-modal" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Detalle de payload</h4>
          <button id="modal-close">Cerrar</button>
        </div>
        <pre id="modal-body">Sin datos</pre>
      </div>
    </div>

    <div class="modal" id="einvoice-modal" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h4>Factura electronica</h4>
            <p class="kpi-sub" id="einvoice-order">Pedido: -</p>
          </div>
          <button id="einvoice-close">Cerrar</button>
        </div>
        <div class="settings-grid modal-form">
          <div class="field">
            <label>Facturar electronicamente</label>
            <input type="checkbox" id="einvoice-flag" />
          </div>
          <div class="field">
            <label>Nombre fiscal</label>
            <input type="text" id="einvoice-name" placeholder="Nombre o razon social" />
          </div>
          <div class="field">
            <label>Tipo de documento</label>
            <select id="einvoice-id-type">
              <option value="">Seleccionar</option>
              <option value="CC">CC</option>
              <option value="NIT">NIT</option>
              <option value="CE">CE</option>
              <option value="TI">TI</option>
              <option value="PP">Pasaporte</option>
              <option value="OTRO">Otro</option>
            </select>
          </div>
          <div class="field">
            <label>Numero de documento</label>
            <input type="text" id="einvoice-id-number" placeholder="Documento" />
          </div>
          <div class="field">
            <label>Email</label>
            <input type="email" id="einvoice-email" placeholder="correo@cliente.com" />
          </div>
          <div class="field">
            <label>Telefono</label>
            <input type="text" id="einvoice-phone" placeholder="Telefono" />
          </div>
          <div class="field">
            <label>Direccion</label>
            <input type="text" id="einvoice-address" placeholder="Calle 123 # 4-56" />
          </div>
          <div class="field">
            <label>Ciudad</label>
            <input type="text" id="einvoice-city" placeholder="Ciudad" />
          </div>
          <div class="field">
            <label>Departamento</label>
            <input type="text" id="einvoice-state" placeholder="Departamento" />
          </div>
          <div class="field">
            <label>Pais</label>
            <input type="text" id="einvoice-country" placeholder="Colombia" />
          </div>
          <div class="field">
            <label>Codigo postal</label>
            <input type="text" id="einvoice-zip" placeholder="Codigo postal" />
          </div>
        </div>
        <div class="toolbar">
          <button class="primary" id="einvoice-save" type="button">Guardar</button>
          <span class="kpi-sub" id="einvoice-status">-</span>
        </div>
      </div>
    </div>

	    <div class="modal" id="photos-modal" aria-hidden="true">
	      <div class="modal-content">
	        <div class="modal-header">
	          <div>
	            <h4>Cargador masivo de fotos</h4>
	            <p class="kpi-sub">Sube URLs de imágenes por SKU o código de barras (CSV desde Excel).</p>
	          </div>
	          <div class="modal-actions">
	            <button class="ghost" id="photos-template" type="button">Descargar plantilla</button>
	            <button id="photos-close" type="button">Cerrar</button>
	          </div>
	        </div>
	        <div class="settings-grid modal-form">
	          <div class="field">
	            <label>Archivo CSV</label>
	            <input type="file" id="photos-file" accept=".csv,text/csv" />
	            <p class="field-hint">
	              Columnas recomendadas: <code>sku</code> o <code>barcode</code> y <code>images</code> (URLs separadas por <code>|</code>).
	              También aceptamos <code>image_1</code>, <code>image_2</code>...
	            </p>
	          </div>
          <div class="field">
            <label for="photos-match-by">Match por</label>
            <select id="photos-match-by">
              <option value="sku" selected>SKU</option>
              <option value="barcode">Código de barras</option>
            </select>
          </div>
          <div class="field">
            <label for="photos-attach-variant">Asociar a variante <span class="tip" data-tip="Si está ON, intentamos asociar la imagen a la variante encontrada (si Shopify lo permite). Si OFF, se sube como imagen del producto.">?</span></label>
            <input type="checkbox" id="photos-attach-variant" class="toggle" checked />
          </div>
          <div class="field">
            <label for="photos-mode">Modo de imágenes <span class="tip" data-tip="Agregar = conserva fotos existentes y añade nuevas. Reemplazar = elimina fotos existentes del producto y luego sube las nuevas (puede ser más lento).">?</span></label>
            <select id="photos-mode">
              <option value="append" selected>Agregar</option>
              <option value="replace">Reemplazar</option>
            </select>
          </div>
          <div class="field">
            <label for="photos-publish-enabled">Cambiar estado del producto <span class="tip" data-tip="ON: al terminar de subir fotos, forzamos el estado del producto (Borrador/Activo). OFF: no tocamos el estado.">?</span></label>
            <input type="checkbox" id="photos-publish-enabled" class="toggle" />
          </div>
	          <div class="field" id="photos-publish-status-field" hidden>
	            <label for="photos-publish-status">Estado</label>
	            <select id="photos-publish-status">
	              <option value="draft" selected>Borrador</option>
	              <option value="active">Activo</option>
	            </select>
	          </div>
	        </div>
	        <div class="toolbar">
	          <button class="primary" id="photos-run" type="button">Ejecutar</button>
	          <button class="ghost danger" id="photos-stop" type="button" hidden>Detener</button>
	          <button class="ghost" id="photos-clear" type="button">Limpiar</button>
	          <button class="ghost" id="photos-download-errors" type="button">Descargar errores</button>
	          <span class="kpi-sub" id="photos-status">Sin datos</span>
	        </div>
        <div class="sync-progress" id="photos-progress" aria-hidden="true">
          <div class="sync-progress-track">
            <div class="sync-progress-bar" id="photos-progress-bar"></div>
          </div>
          <span class="sync-progress-label" id="photos-progress-label">Procesando 0%</span>
        </div>
        <pre id="photos-errors" class="modal-errors">Sin errores.</pre>
      </div>
    </div>

    <script src="app.js?v=20260210p14" type="module"></script>
	  </body>
	</html>
