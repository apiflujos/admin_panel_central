<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ApiFlujos - Alegra Integraciones</title>
    <link rel="icon" type="image/png" href="/favicon.png?v=20260201s" />
    <link rel="stylesheet" href="styles.css?v=20260204p17" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <div class="sidebar-header">
          <button class="ghost sidebar-toggle" id="sidebar-toggle" aria-label="Colapsar menu" title="Colapsar menu">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <path d="M15 6l-6 6 6 6" />
            </svg>
          </button>
        </div>
        <nav class="nav">
          <button class="nav-item is-active" data-target="dashboard" title="Metricas">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M4 20V10M10 20V4M16 20v-7M22 20H2" />
              </svg>
            </span>
            <span class="nav-label">Metricas</span>
          </button>
          <button class="nav-item" data-target="operations" title="Pedidos">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M7 8h10M7 12h10M7 16h6" />
                <path d="M6 4h12a2 2 0 0 1 2 2v12l-3-2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
              </svg>
            </span>
            <span class="nav-label">Pedidos</span>
          </button>
          <button class="nav-item" data-target="contacts" title="Contactos">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M16 11a4 4 0 1 1-8 0 4 4 0 0 1 8 0z" />
                <path d="M4 20a8 8 0 0 1 16 0" />
              </svg>
            </span>
            <span class="nav-label">Contactos</span>
          </button>
          <button class="nav-item" data-target="products" title="Productos">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M3 7h18v13H3z" />
                <path d="M7 7l5-4 5 4" />
              </svg>
            </span>
            <span class="nav-label">Productos</span>
          </button>
          <button class="nav-item" data-target="logs" title="Logs de API">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M5 4h10l4 4v12H5z" />
                <path d="M8 12h8M8 16h8M8 8h4" />
              </svg>
            </span>
            <span class="nav-label">Logs de API</span>
          </button>
	          <button class="nav-item" data-target="settings" title="Configuracion">
	            <span class="nav-icon" aria-hidden="true">
	              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
	                <circle cx="12" cy="12" r="3.2" />
	                <path d="M19.4 15a7.5 7.5 0 0 0 0-6l2-1.2-2-3.4-2.3 1a7.4 7.4 0 0 0-5.2-2.2L11 1H7l-.6 2.2a7.4 7.4 0 0 0-5.2 2.2l-2.3-1-2 3.4 2 1.2a7.5 7.5 0 0 0 0 6l-2 1.2 2 3.4 2.3-1a7.4 7.4 0 0 0 5.2 2.2L7 23h4l.6-2.2a7.4 7.4 0 0 0 5.2-2.2l2.3 1 2-3.4-2-1.2z" />
	              </svg>
	            </span>
	            <span class="nav-label">Configuracion</span>
	          </button>
		          <div class="nav-submenu" id="settings-submenu" aria-label="Submenu configuracion">
		            <button class="nav-subitem is-active" type="button" data-settings-pane-link="connections" title="Conexiones">Conexiones</button>
		            <button class="nav-subitem" type="button" data-settings-pane-link="stores" title="Tiendas">Tiendas</button>
		            <button class="nav-subitem" type="button" data-settings-pane-link="integrations" title="Integraciones">Integraciones</button>
		          </div>
	        </nav>
	        <div class="sidebar-footer"></div>
	      </aside>

      <main class="content">
        <header class="topbar">
          <div class="topbar-left">
            <h1>Metricas Olivia Shoes</h1>
            <p class="subtitle">Visibilidad operativa en tiempo real.</p>
          </div>
          <div class="topbar-center">
            <div class="topbar-brand apiflujos-brand">
              <img id="company-logo" src="/assets/logo.png" alt="ApiFlujos" />
            </div>
          </div>
          <div class="topbar-actions">
            <div class="topbar-user" id="topbar-user">
              <button class="ghost topbar-user-trigger" id="topbar-user-toggle" type="button">
                <img id="user-avatar" src="/assets/avatar.png" alt="Usuario" />
                <div class="topbar-user-meta">
                  <span id="user-name">Usuario</span>
                  <span id="user-role">Agente</span>
                </div>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </button>
              <div class="topbar-user-menu" id="topbar-user-menu">
                <button class="ghost" data-user-action="profile">Perfil usuario</button>
                <button class="ghost admin-only" data-user-action="company">Perfil empresa</button>
                <button class="ghost admin-only" data-user-action="users">Usuarios</button>
                <button class="ghost" data-user-action="logout">Cerrar sesion</button>
              </div>
            </div>
          </div>
        </header>
        <div class="sync-progress" id="sync-progress" aria-hidden="true">
          <div class="sync-progress-track">
            <div class="sync-progress-bar" id="sync-progress-bar"></div>
          </div>
          <span class="sync-progress-label" id="sync-progress-label">Sincronizando 0%</span>
        </div>

        <section class="section is-active" id="dashboard">
          <div class="metrics-layout">
            <div class="metrics-right">
              <div class="metrics-hero">
                <div>
                  <p class="metrics-kicker">Metricas</p>
                  <h2>Panorama operativo Olivia Shoes</h2>
                  <p class="metrics-sub">Ventas, pedidos y actividad de sincronizacion en un solo lugar.</p>
                </div>
                <div class="metrics-controls">
                  <div class="metrics-control">
                    <label for="metrics-range">Rango</label>
                    <select id="metrics-range">
                      <option value="day">Hoy</option>
                      <option value="week">Semana</option>
                      <option value="month" selected>Mes</option>
                    </select>
                  </div>
                  <div class="metrics-status">
                    <span class="status-pill" id="metrics-shopify-status">Shopify</span>
                    <span class="status-pill" id="metrics-alegra-status">Alegra</span>
                  </div>
                </div>
              </div>

              <div class="section-title">Panel de Victorias</div>
              <div class="kpi-grid metrics-kpi-grid victories-kpis">
                <div class="kpi-card">
                  <p id="kpi-shopify-label">Pedidos Shopify</p>
                  <span class="kpi-source">Fuente: Shopify</span>
                  <h2 id="kpi-sales-today">--</h2>
                  <span class="kpi-sub" id="kpi-sales-today-sub">Vs ayer</span>
                </div>
                <div class="kpi-card">
                  <p id="kpi-alegra-label">Facturacion Alegra</p>
                  <span class="kpi-source">Fuente: Alegra</span>
                  <h2 id="kpi-billing-alegra">--</h2>
                  <span class="kpi-sub" id="kpi-billing-alegra-sub">Vs mes pasado</span>
                </div>
                <div class="kpi-card kpi-chart">
                  <p id="chart-weekly-label">Crecimiento pedidos</p>
                  <span class="kpi-source">Fuente: Shopify</span>
                  <div class="chart-placeholder chart-compact" id="chart-weekly"></div>
                </div>
                <div class="kpi-card kpi-chart" id="chart-alegra-card">
                  <p id="chart-alegra-label">Crecimiento facturacion</p>
                  <span class="kpi-source">Fuente: Alegra</span>
                  <div class="chart-placeholder chart-compact" id="chart-alegra"></div>
                </div>
              </div>

              <div class="metrics-victories">
                <div class="panel" id="panel-top-products">
                  <div class="panel-header">
                    <h3>Top 10 Productos Estrella</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Shopify</span>
                      <span class="panel-tag">Unidades</span>
                    </div>
                  </div>
                  <div class="chart-placeholder" id="wins-top-products"></div>
                </div>
                <div class="panel" id="panel-top-revenue">
                  <div class="panel-header">
                    <h3>Top 10 Generadores de Caja</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Shopify</span>
                      <span class="panel-tag">Facturacion</span>
                    </div>
                  </div>
                  <div class="table-card">
                    <table class="table" id="wins-top-revenue">
                      <thead>
                        <tr>
                          <th>Producto</th>
                          <th>Total</th>
                          <th>Unidades</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
                <div class="panel" id="panel-top-cities">
                  <div class="panel-header">
                    <h3>Top 10 Ciudades Destino</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Shopify</span>
                      <span class="panel-tag">Colombia</span>
                    </div>
                  </div>
                  <div class="chart-placeholder" id="wins-top-cities"></div>
                </div>
                <div class="panel" id="panel-top-customers">
                  <div class="panel-header">
                    <h3>Top 10 Clientes VIP</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Shopify</span>
                      <span class="panel-tag">Ticket promedio</span>
                    </div>
                  </div>
                  <div class="table-card">
                    <table class="table" id="wins-top-customers">
                      <thead>
                        <tr>
                          <th>Cliente</th>
                          <th>Ticket Promedio</th>
                          <th>Total</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
                <div class="panel" id="panel-payment-methods">
                  <div class="panel-header">
                    <h3>Participacion por Metodos de Pago</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Alegra</span>
                      <span class="panel-tag">Alegra</span>
                    </div>
                  </div>
                  <div class="chart-placeholder" id="wins-payment-methods"></div>
                </div>
              </div>

              <div class="section-title">Panel de Control y Ajustes</div>
              <div class="metrics-attention">
                <div class="panel" id="panel-inventory-alerts">
                  <div class="panel-header">
                    <h3>Alertas de Inventario y Stock</h3>
                    <div class="panel-meta">
                      <span class="panel-source">Fuente: Alegra</span>
                      <span class="panel-tag">Operativo</span>
                    </div>
                  </div>
                  <div class="panel-split">
                    <div class="table-card" id="card-low-stock">
                      <h4 class="panel-subtitle">Proximos a agotarse</h4>
                      <table class="table" id="alert-low-stock">
                        <thead>
                          <tr>
                            <th>Producto</th>
                            <th>Stock</th>
                            <th>Ventas 7d</th>
                          </tr>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                    <div class="table-card" id="card-inactive-products">
                      <h4 class="panel-subtitle">Productos inactivos</h4>
                      <table class="table" id="alert-inactive-products">
                        <thead>
                          <tr>
                            <th>Producto</th>
                            <th>Stock</th>
                            <th>Ventas 7d</th>
                          </tr>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="profile">
          <div class="panel" id="profile-panel">
            <div class="panel-header">
              <h3>Perfil</h3>
              <span class="panel-tag">Usuario</span>
            </div>
            <div class="settings-grid">
              <div class="field">
                <label>Nombre</label>
                <input type="text" id="profile-name" placeholder="Nombre completo" />
              </div>
              <div class="field">
                <label>Email</label>
                <input type="email" id="profile-email" placeholder="correo@empresa.com" />
              </div>
              <div class="field">
                <label>Telefono</label>
                <input type="tel" id="profile-phone" placeholder="+57..." />
              </div>
              <div class="field">
                <label>Foto de perfil</label>
                <input type="file" id="profile-photo" accept="image/*" />
              </div>
              <div class="field field-actions">
                <label>&nbsp;</label>
                <button class="primary" id="profile-save" type="button">Guardar perfil</button>
              </div>
              <div class="field">
                <label>Contrasena actual</label>
                <input type="password" id="password-current" autocomplete="current-password" />
              </div>
              <div class="field">
                <label>Nueva contrasena</label>
                <input type="password" id="password-new" autocomplete="new-password" />
              </div>
              <div class="field">
                <label>Confirmar contrasena</label>
                <input type="password" id="password-confirm" autocomplete="new-password" />
              </div>
              <div class="field field-actions">
                <label>&nbsp;</label>
                <button class="primary" id="password-save" type="button">Cambiar contrasena</button>
              </div>
              <div class="field field-span">
                <p class="field-hint" id="password-message"></p>
              </div>
            </div>
            <p class="field-hint" id="profile-message"></p>
          </div>
        </section>

        <section class="section" id="operations">
          <div class="panel">
            <div class="panel-header">
              <h3>Gestion de pedidos</h3>
              <span class="panel-tag">Pedidos</span>
            </div>
            <div class="toolbar products-toolbar">
              <div class="toolbar-store">
                <label for="orders-store-select">Tienda</label>
                <select id="orders-store-select"></select>
              </div>
              <input type="text" id="ops-search" placeholder="Buscar por orden, cliente o producto" />
              <input type="date" id="orders-date-filter" />
              <select id="orders-days">
                <option value="7">Ultimos 7 dias</option>
                <option value="15">Ultimos 15 dias</option>
                <option value="30" selected>Ultimos 30 dias</option>
                <option value="60">Ultimos 60 dias</option>
                <option value="90">Ultimos 90 dias</option>
              </select>
              <select id="orders-sort">
                <option value="date_desc">Orden: Fecha (recientes)</option>
                <option value="date_asc">Orden: Fecha (antiguos)</option>
                <option value="order_asc">Orden: Numero (asc)</option>
                <option value="order_desc">Orden: Numero (desc)</option>
              </select>
              <input type="number" id="orders-limit" min="1" placeholder="Filas por pagina" />
              <button class="ghost" id="ops-search-btn">Buscar</button>
              <button class="primary" id="orders-refresh">Refrescar</button>
              <button class="ghost" id="orders-clear">Borrar filtros</button>
            </div>
            <div class="sync-progress" id="orders-progress" aria-hidden="true">
              <div class="sync-progress-track">
                <div class="sync-progress-bar" id="orders-progress-bar"></div>
              </div>
              <span class="sync-progress-label" id="orders-progress-label">Sincronizando 0%</span>
            </div>
            <div class="table-card orders-table">
              <table class="table" id="ops-table">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Nro. Orden</th>
                    <th>Cliente</th>
                    <th>Productos</th>
                    <th>Estado Alegra</th>
                    <th>Accion</th>
                    <th>Nro. Factura</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="7" class="empty">Sin ordenes para mostrar.</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="products-footer orders-footer">
              <span id="orders-page">Pagina 1</span>
              <div class="products-pagination">
                <button class="ghost" id="orders-prev">Anterior</button>
                <button class="ghost" id="orders-next">Siguiente</button>
              </div>
              <div class="products-pagination">
                <input type="number" id="orders-page-input" min="1" placeholder="Ir a" />
                <button class="ghost" id="orders-page-go">Ir</button>
              </div>
              <span id="orders-count">Mostrando 0 de 0</span>
            </div>
          </div>
        </section>

        <section class="section" id="products">
          <div class="panel">
            <div class="panel-header">
              <h3>Gestion de productos</h3>
              <span class="panel-tag">Alegra → Shopify</span>
            </div>
            <div class="toolbar products-toolbar">
              <div class="toolbar-store">
                <label for="products-store-select">Tienda</label>
                <select id="products-store-select"></select>
              </div>
              <input type="text" id="products-search" placeholder="Buscar por nombre o referencia" />
              <input type="date" id="products-date-filter" />
              <select id="products-sort">
                <option value="date_desc">Orden: Fecha (recientes)</option>
                <option value="date_asc">Orden: Fecha (antiguos)</option>
                <option value="ref_asc">Orden: Referencia (A-Z)</option>
                <option value="ref_desc">Orden: Referencia (Z-A)</option>
              </select>
              <input type="number" id="products-limit" min="1" max="30" value="30" placeholder="Limite listado" />
              <button class="ghost" id="products-search-btn">Buscar</button>
              <button class="primary" id="products-refresh">Refrescar</button>
              <button class="ghost" id="products-clear">Borrar filtros</button>
            </div>
            <div class="toolbar products-filters">
              <div class="filter-group">
                <label class="filter-label">Bodegas</label>
                <details class="multi-select">
                  <summary>
                    <span>Seleccionar bodegas</span>
                    <em id="products-warehouse-summary">Todas</em>
                  </summary>
                  <div class="checkbox-grid single" id="products-warehouse-filter"></div>
                </details>
              </div>
              <label class="filter-inline">
                <input type="checkbox" id="products-instock-only" />
                <span>Solo con existencias</span>
              </label>
              <select id="products-status-filter">
                <option value="all">Estado Alegra: Todos</option>
                <option value="active">Activos</option>
                <option value="inactive">Inactivos</option>
              </select>
            </div>
            <div class="sync-progress" id="products-progress" aria-hidden="true">
              <div class="sync-progress-track">
                <div class="sync-progress-bar" id="products-progress-bar"></div>
              </div>
              <span class="sync-progress-label" id="products-progress-label">Sincronizando 0%</span>
            </div>
            <div class="table-card products-table">
                <table class="table" id="products-table">
                  <thead>
                    <tr>
                      <th>Producto / Referencia</th>
                      <th>ID Alegra</th>
                      <th>ID Shopify</th>
	                      <th>Referencia/SKU</th>
                      <th>Fecha</th>
                      <th>Estado Alegra</th>
                      <th>Stock total</th>
                      <th>Estado Shopify</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td colspan="9" class="empty">Sin productos para mostrar.</td>
                    </tr>
                  </tbody>
                </table>
            </div>
            <div class="products-footer">
              <span id="products-page">Pagina 1</span>
              <div class="products-pagination">
                <button class="ghost" id="products-prev">Anterior</button>
                <button class="ghost" id="products-next">Siguiente</button>
              </div>
              <div class="products-pagination">
                <input type="number" id="products-page-input" min="1" placeholder="Ir a" />
                <button class="ghost" id="products-page-go">Ir</button>
              </div>
              <span id="products-count">Mostrando 0 de 0</span>
              <span class="products-status" id="products-status">Listo para sincronizar</span>
            </div>
          </div>
        </section>

        <section class="section" id="contacts">
          <div class="panel">
            <div class="panel-header">
              <h3>Gestion de contactos</h3>
              <span class="panel-tag">Contactos</span>
            </div>
            <div class="toolbar products-toolbar">
              <div class="toolbar-store">
                <label for="contacts-store-select">Tienda</label>
                <select id="contacts-store-select"></select>
              </div>
              <input type="text" id="contacts-search" placeholder="Buscar por nombre, email o telefono" />
              <input type="date" id="contacts-date-start" />
              <input type="date" id="contacts-date-end" />
              <select id="contacts-status">
                <option value="">Estado: Todos</option>
                <option value="synced">Sincronizado</option>
                <option value="pending">Pendiente</option>
              </select>
              <select id="contacts-source">
                <option value="">Origen: Todos</option>
                <option value="shopify">Shopify</option>
                <option value="alegra">Alegra</option>
              </select>
              <input type="number" id="contacts-limit" min="1" placeholder="Filas por pagina" />
              <button class="ghost" id="contacts-search-btn">Buscar</button>
              <button class="primary" id="contacts-refresh">Refrescar</button>
              <button class="ghost" id="contacts-clear">Borrar filtros</button>
            </div>
            <div class="table-card">
              <table class="table" id="contacts-table">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Telefono</th>
                    <th>Documento</th>
                    <th>Origen</th>
                    <th>Estado</th>
                    <th>Shopify</th>
                    <th>Alegra</th>
                    <th>Actualizado</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="9" class="empty">Sin contactos para mostrar.</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="products-footer">
              <span id="contacts-page">Pagina 1</span>
              <div class="products-pagination">
                <button class="ghost" id="contacts-prev">Anterior</button>
                <button class="ghost" id="contacts-next">Siguiente</button>
              </div>
              <div class="products-pagination">
                <input type="number" id="contacts-page-input" min="1" placeholder="Ir a" />
                <button class="ghost" id="contacts-page-go">Ir</button>
              </div>
              <span id="contacts-count">Mostrando 0 de 0</span>
            </div>
          </div>
        </section>

        <section class="section" id="logs">
          <div class="panel">
            <div class="panel-header">
              <h3>Logs de API</h3>
              <span class="panel-tag">Trazabilidad</span>
            </div>
            <div class="toolbar">
              <input type="text" placeholder="ID de pedido" id="log-order-id" />
              <select id="log-status">
                <option value="">Todos</option>
                <option value="success">Exitosos</option>
                <option value="fail">Errores</option>
                <option value="retrying">Reintentando</option>
              </select>
              <button class="ghost" id="log-filter">Filtrar</button>
              <button class="primary" id="log-retry">Reintentar fallidos</button>
              <span class="status-pill" id="queue-status">Sin datos</span>
            </div>
            <table class="table" id="log-table">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Entidad</th>
                  <th>Direccion</th>
                  <th>Estado</th>
                  <th>Detalle</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="6" class="empty">Sin datos.</td>
                </tr>
              </tbody>
            </table>
          </div>
	        </section>

		        <section class="section" id="settings">
		          <div class="settings-pane is-active" data-settings-pane="connections">
				            <div class="panel admin-only module" data-module="connections" data-module-readonly="false" data-setup-open="0" data-help="Configurar tienda (paso a paso):&#10;1) En Nueva conexion: elige configuracion guiada o manual.&#10;2) Conecta Shopify (autorizacion) y luego Alegra (clave de acceso o cuenta guardada).&#10;3) En Tiendas: confirma la tienda activa (ej: Oliva Shoes Colombia).&#10;4) Configura Productos, Pedidos y Contactos segun tu forma de trabajo.&#10;5) Revisa Operacion (sincronizacion automatica y salud).&#10;&#10;Tip: la configuracion guiada es para tienda nueva; si ya hay tienda activa, usa Manual.">
		            <div class="panel-header">
		              <h3 data-module-toggle="connections" data-title-base="Nueva conexion">Nueva conexion</h3>
		              <span class="panel-tag">Acceso</span>
	            </div>
	            <div class="module-body">
              <div class="setup-mode-picker" id="setup-mode-picker" aria-label="Modo de configuracion">
                <button class="setup-mode" type="button" data-setup-mode="guided">Configuracion guiada</button>
                <button class="setup-mode" type="button" data-setup-mode="manual">Configuracion manual</button>
              </div>
	              <div class="connections-form" id="connections-form">
	              <div class="settings-grid store-meta">
		                <div class="field span-2">
		                  <label>Nombre de la tienda <span class="tip" data-tip="Nombre visible de la tienda. Se usa para identificar esta configuracion y aparece en Tiendas.">?</span></label>
		                  <input type="text" id="store-name" placeholder="Tienda de ejemplo" />
		                  <span class="field-hint">Este nombre identifica el set de configuraciones.</span>
	                </div>
	                <div class="field span-2" id="copy-config-field">
	                  <label>Configuracion inicial <span class="tip" data-tip="Opcional. Si ya tienes otra tienda configurada, puedes copiar reglas y sincronizaciones para no empezar desde cero.">?</span></label>
	                  <select id="copy-config-select"></select>
	                  <span class="field-hint">Copia configuracion desde otra tienda o inicia en blanco.</span>
	                </div>
	              </div>
		              <div class="connections-compact">
	                <div class="connection-block">
	                  <div class="connection-block-header">
	                    <div>
	                      <div class="provider-title">
                        <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
                        <h4>Shopify</h4>
                      </div>
	                      <p class="kpi-sub">Autorizacion de Shopify para esta tienda</p>
                    </div>
                    <div class="connection-block-actions">
                      <span class="status-pill is-off" id="shopify-connection-pill">Pendiente</span>
                      <button class="primary" id="connect-shopify" type="button">Conectar Shopify</button>
                    </div>
	                  </div>
		                  <div class="settings-grid connection-fields">
		                    <div class="field span-2">
			                      <label>Shopify dominio <span class="tip" data-tip="Dominio de la tienda (ej: tu-tienda.myshopify.com). Se usa para conectar Shopify a esta integracion.">?</span></label>
			                      <input type="text" id="shopify-domain" placeholder="tu-tienda.myshopify.com" />
			                      <span class="field-hint">Se usa para iniciar la autorizacion de Shopify.</span>
		                    </div>
			                    <div class="field span-2">
			                      <label>Metodo de conexion <span class="tip" data-tip="Elige como conectar Shopify: por autorizacion (OAuth2) o por clave de acceso (Admin API).">?</span></label>
			                      <div class="setup-mode-picker" id="shopify-connect-picker" aria-label="Metodo de conexion Shopify">
			                        <button class="setup-mode is-active" type="button" data-shopify-connect="oauth">Por autorizacion</button>
			                        <button class="setup-mode" type="button" data-shopify-connect="token">Por clave de acceso</button>
			                      </div>
			                      <span class="field-hint" id="shopify-connect-hint">Por autorizacion abre la pantalla de Shopify para conectar esta tienda.</span>
			                    </div>
			                    <div class="field span-2" id="shopify-token-field">
			                      <label>Clave de acceso Shopify <span class="tip" data-tip="Pega aqui la clave de acceso (Admin API) de Shopify para esta tienda y presiona Conectar Shopify.">?</span></label>
			                      <input type="password" id="shopify-token" placeholder="shpat_********" autocomplete="new-password" />
			                      <span class="field-hint">Se guarda cifrada. Usala si no puedes conectar por autorizacion.</span>
			                    </div>
		                  </div>
                </div>

                <div class="connection-block">
                  <div class="connection-block-header">
                    <div>
                      <div class="provider-title">
                        <img class="provider-logo" src="/brands/alegra.png?v=20260201s" alt="Alegra" />
                        <h4>Alegra</h4>
                      </div>
                      <p class="kpi-sub">Cuenta y credenciales</p>
                    </div>
                    <div class="connection-block-actions">
                      <span class="status-pill is-off" id="alegra-connection-pill">Pendiente</span>
                      <button class="primary" id="connect-alegra" type="button">Conectar Alegra</button>
                    </div>
	                  </div>
	                  <div class="settings-grid connection-fields">
	                    <div class="field">
		                      <label>Cuenta Alegra <span class="tip" data-tip="Selecciona una cuenta guardada o crea una nueva con email + clave de acceso.">?</span></label>
	                      <select id="alegra-account-select">
	                        <option value="new">Nueva cuenta Alegra</option>
	                      </select>
	                    </div>
	                    <div class="field" id="alegra-env-field">
	                      <label>Entorno Alegra <span class="tip" data-tip="Produccion es el entorno real. Pruebas es para validar sin afectar tu operacion (si tu cuenta lo soporta).">?</span></label>
	                      <select id="alegra-env-select">
	                        <option value="prod">Produccion</option>
	                        <option value="sandbox">Pruebas</option>
	                      </select>
	                    </div>
	                    <div class="field">
	                      <label>Email usuario <span class="tip" data-tip="Email del usuario de Alegra con acceso a la cuenta.">?</span></label>
	                      <input type="email" id="alegra-email" placeholder="admin@empresa.com" />
	                    </div>
	                    <div class="field">
	                      <label>Clave de acceso <span class="tip" data-tip="Clave de acceso de Alegra (se guarda cifrada). Si seleccionas una cuenta guardada y te pide reconectar, pega la clave aqui para actualizarla.">?</span></label>
		                      <input type="password" id="alegra-key" placeholder="api_********" autocomplete="new-password" />
	                    </div>
	                  </div>
                </div>

                <div class="connection-block">
                  <div class="connection-block-header">
                    <div>
                      <div class="provider-title">
                        <img class="provider-logo" src="/brands/openai.png?v=20260201s" alt="OpenAI" />
                        <h4>IA</h4>
                      </div>
	                      <p class="kpi-sub">Clave del proveedor de IA</p>
	                    </div>
	                    <button class="primary" id="ai-save" type="button">Guardar clave</button>
		                  </div>
		                  <div class="settings-grid connection-fields">
		                    <div class="field span-2">
			                      <label>Token de IA <span class="tip" data-tip="Clave del proveedor de IA (por ejemplo OpenAI). Se usa para el asistente y soporte.">?</span></label>
	                      <input type="password" id="ai-key" placeholder="sk-********" autocomplete="new-password" />
		                  </div>
		                </div>
	              </div>
	              </div>
	            </div>
	          </div>
	        </div>

          <div class="panel admin-only module" data-provider="bridge" data-module="connections-summary" data-help="Resumen de conexiones guardadas. Cada tarjeta corresponde a una tienda (multi-tienda).">
            <div class="panel-header">
              <h3 data-module-toggle="connections-summary">Conexiones guardadas</h3>
              <span class="panel-tag tag-bridge">Conexiones</span>
            </div>
            <div class="module-body">
              <div class="connections-grid" id="connections-grid">
                <div class="connection-card empty">Sin conexiones.</div>
              </div>
            </div>
          </div>
	      </div>

	      <div class="settings-pane" data-settings-pane="integrations">
	        <div class="settings-group provider-group" data-group="integrations">
	          <div class="settings-group-header" data-group-toggle="integrations">
	            <h4 class="group-title">Integraciones</h4>
	          </div>
	          <div class="settings-group-body">
	            <div class="panel admin-only module" data-provider="bridge" data-module="qa-token" id="qa-token-panel" data-help="Genera una clave temporal para integraciones y pruebas (API) sin consola.">
	              <div class="panel-header">
	                <h3 data-module-toggle="qa-token">Clave temporal de integracion</h3>
	                <span class="panel-tag tag-bridge">Integraciones</span>
	              </div>
	              <div class="module-body">
	                <div class="settings-grid">
	                  <div class="field span-2">
	                    <label>Clave temporal</label>
	                    <div class="field-actions inline">
	                      <input type="text" id="qa-token-value" readonly placeholder="Genera una clave temporal" />
	                      <button class="ghost" id="qa-token-copy" type="button">Copiar</button>
	                    </div>
	                    <p class="field-hint" id="qa-token-hint">Vence en 30 minutos.</p>
	                  </div>
	                </div>
	                <div class="toolbar is-actions">
	                  <button class="primary" id="qa-token-generate" type="button">Generar clave</button>
	                </div>
	              </div>
	            </div>
	          </div>
	        </div>
	      </div>

		        <div class="settings-pane" data-settings-pane="stores">
		          <div class="panel admin-only" id="stores-switcher-panel" data-help="Tiendas conectadas: elige la tienda activa. Todo lo de abajo (productos, pedidos, contactos, etc.) se guarda por tienda activa.">
		            <div class="panel-header">
		              <h3>Tiendas conectadas</h3>
		            </div>
		            <div class="module-body">
		              <div class="settings-grid store-meta">
		                <div class="field span-2" id="store-active-field">
		                  <label>Tienda activa <span class="tip" data-tip="Cambia la tienda activa para ver y guardar configuraciones diferentes por tienda.">?</span></label>
		                  <div class="field-actions inline">
			                  <select id="store-active-select"></select>
			                  <button class="ghost danger" id="store-delete" type="button" title="Eliminar tienda">Eliminar tienda</button>
		                  </div>
		                </div>
		                <div class="field span-2">
		                  <span class="field-hint store-scope-hint">Todo lo de abajo se guarda por tienda. Si cambias de tienda activa, cambian estos ajustes.</span>
		                </div>
		              </div>
		            </div>
		          </div>

		          <div class="settings-group store-group" data-group="store">
		            <div class="settings-group-header" data-group-toggle="store" data-help="Configuracion de la tienda activa: todo lo de abajo aplica solo a la tienda seleccionada arriba.">
		              <h3 data-store-title data-title-base="Tienda activa">Tienda activa</h3>
		              <span class="settings-group-subtitle">Configuracion por tienda</span>
		            </div>
		            <div class="settings-group-body">

			          <div class="settings-group provider-group" data-group="products">
			                <div class="settings-group-header" data-group-toggle="products">
			                  <h4 class="group-title">
		                    <img class="provider-logo" src="/brands/alegra.png?v=20260201s" alt="Alegra" />
	                    <span class="group-arrow">→</span>
                    <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
                    Productos e inventario
                  </h4>
                </div>
                <div class="settings-group-body">
                  <div class="panel admin-only module" data-provider="bridge" data-manager="alegra" data-module="shopify-rules" data-module-priority="core" id="legacy-publish-panel" data-help="Modulo principal de Productos: define como se publican y actualizan productos en Shopify cuando llegan cambios desde Alegra (automatico: se sincroniza solo) o cuando publicas manual/masivo desde el panel de Productos.">
                    <div class="panel-header">
	                      <h3 data-module-toggle="shopify-rules" data-title-base="Sincronizacion y publicacion de productos">
	                        Sincronizacion y publicacion de productos
	                        <span class="tip" data-tip="Define como se sincronizan y publican productos desde Alegra hacia Shopify: masivo para iniciar catalogo y reglas para el modo automatico.">?</span>
	                      </h3>
                      <div class="panel-meta">
                        <span class="panel-tag tag-core">Core</span>
                        <span class="panel-tag tag-bridge">Alegra → Shopify</span>
                      </div>
                    </div>
                    <div class="module-body">
                      <div class="mode-sections">
	                        <div class="mode-section" data-readonly-free="1">
		                          <div class="mode-head">
		                            <div class="mode-head-left">
		                              <h4>Sincronizacion masiva (inicio)</h4>
		                              <span class="tip" data-tip="Úsala para crear el catálogo inicial en Shopify desde Alegra. Toma productos por rango de fechas y aplica tus opciones (publicar, estado e inventario). Recomendación: prueba primero con un rango corto.">?</span>
		                            </div>
		                          </div>
                          <div class="mode-grid">
                            <div class="mode-field">
                              <label for="products-date-start">Fecha inicio</label>
                              <input type="date" id="products-date-start" />
                            </div>
                            <div class="mode-field">
                              <label for="products-date-end">Fecha fin</label>
                              <input type="date" id="products-date-end" />
                            </div>
                            <div class="mode-field">
                              <label for="products-sync-limit">Limite (opcional)</label>
                              <input type="number" id="products-sync-limit" min="1" placeholder="200" />
                            </div>
                          </div>
	                          <div class="mode-toggle-grid" aria-label="Opciones masivo">
		                            <div class="mode-toggle">
		                              <label for="products-sync-only-active">Solo activos en Alegra <span class="tip" data-tip="Si está activo, el masivo ignora productos inactivos en Alegra. Recomendado para evitar crear productos descontinuados en Shopify.">?</span></label>
		                              <input type="checkbox" id="products-sync-only-active" class="toggle" checked />
		                            </div>
		                            <div class="mode-toggle">
		                              <label for="products-sync-publish">Publicar en Shopify <span class="tip" data-tip="Si lo apagas, solo sincronizamos/actualizamos datos, pero no publicamos en Shopify. Útil si quieres revisar primero y publicar después.">?</span></label>
		                              <input type="checkbox" id="products-sync-publish" class="toggle" checked />
		                            </div>
		                            <div class="mode-toggle">
		                              <label for="products-publish-status-mass">Estado <span class="tip" data-tip="Borrador = no visible en la tienda. Activo = visible y listo para vender. Solo aplica si “Publicar en Shopify” está activo.">?</span></label>
		                              <select id="products-publish-status-mass" data-depends-on="products-sync-publish">
		                                <option value="draft">Borrador</option>
		                                <option value="active">Activo</option>
		                              </select>
		                            </div>
		                            <div class="mode-toggle">
		                              <label for="products-sync-include-inventory">Incluir inventario <span class="tip" data-tip="Si está activo, el masivo también actualiza existencias en Shopify usando las bodegas configuradas en “Inventario y bodegas”.">?</span></label>
		                              <input type="checkbox" id="products-sync-include-inventory" class="toggle" checked />
		                            </div>
	                          </div>
                          <div class="mode-actions">
                            <button class="primary" id="products-sync-filtered" type="button">Sincronizar masivo</button>
	                            <button class="ghost danger" id="products-sync-stop" type="button" hidden>Detener</button>
	                            <button class="ghost" id="products-sync-clear" type="button">Limpiar</button>
	                            <span class="kpi-sub" id="products-sync-status">Sin datos</span>
	                          </div>
	                        </div>

		                        <div class="mode-section">
			                          <div class="mode-head">
			                            <div class="mode-head-left">
			                              <h4>Sincronizacion automatica</h4>
			                              <span class="tip" data-tip="Se ejecuta sola cuando llega un cambio desde Alegra. Estas reglas también aplican cuando publicas manualmente desde Productos (por SKU). Si apagas “Publicar en Shopify”, el sistema no publica productos.">?</span>
			                            </div>
			                          </div>
				                          <div class="mode-toggle-grid" aria-label="Opciones automatico">
				                            <div class="mode-toggle">
				                              <label for="rules-only-active">Solo activos en Alegra <span class="tip" data-tip="Si está activo, solo se sincronizan productos activos en Alegra (automático y manual por SKU).">?</span></label>
			                              <input type="checkbox" id="rules-only-active" class="toggle" />
				                            </div>
				                            <div class="mode-toggle">
				                              <label for="rules-auto-publish">Publicar en Shopify <span class="tip" data-tip="Enciende/apaga la publicación. Si lo apagas, solo sincronizamos datos, pero no publicamos productos (automático ni manual por SKU).">?</span></label>
				                              <input type="checkbox" id="rules-auto-publish" class="toggle" />
				                            </div>
				                            <div class="mode-toggle">
				                              <label for="rules-auto-images">Publicar fotos <span class="tip" data-tip="Si está activo, intentamos subir fotos del producto a Shopify. Si una foto falla, el producto puede publicarse igual (solo quedará sin esa foto).">?</span></label>
				                              <input type="checkbox" id="rules-auto-images" class="toggle" />
				                            </div>
				                            <div class="mode-toggle">
				                              <label for="rules-auto-status">Estado <span class="tip" data-tip="Define el estado de publicación cuando “Publicar en Shopify” está activo: Borrador o Activo.">?</span></label>
				                              <select id="rules-auto-status" data-depends-on="rules-auto-publish">
				                                <option value="draft">Borrador</option>
				                                <option value="active">Activo</option>
				                              </select>
			                            </div>
			                          </div>
	                        </div>
	                      </div>
                      <div class="module-footer">
                        <button class="ghost module-action" data-module-edit="shopify-rules" type="button">Editar</button>
                        <button class="primary module-action" data-module-save="shopify-rules" type="button">Guardar</button>
                      </div>
                      <p class="field-hint module-warning is-hidden" data-module-warning="shopify-rules"></p>
                    </div>
                  </div>

	                  <div class="panel admin-only module" data-provider="bridge" data-manager="alegra" data-module="alegra-inventory" id="inventory-rules-panel" data-help="Inventario automatico por tienda: define de que bodegas se toma el stock y si lo mantenemos actualizado en Shopify.">
	                    <div class="panel-header">
	                      <h3 data-module-toggle="alegra-inventory" data-title-base="Inventario y bodegas">
	                        Ajustes de inventario automático
	                        <span class="tip" data-tip="Esto mantiene el stock al día: corre solo cada cierto tiempo y actualiza Shopify usando las bodegas que elijas.">?</span>
	                      </h3>
	                      <div class="panel-meta">
	                        <span class="panel-tag tag-bridge">Alegra → Shopify</span>
	                      </div>
	                    </div>
                    <div class="module-body">
			                      <div class="mode-sections">
				                        <div class="mode-section">
				                          <div class="mode-head">
				                            <h4>Activar ajustes de inventario</h4>
				                            <span class="tip" data-tip="Prende o apaga la automatización de inventario, define cada cuánto consultar y de qué bodegas tomar el stock.">?</span>
				                          </div>
				                          <div class="mode-toggle-grid" aria-label="Ajustes de inventario">
				                            <div class="mode-toggle">
				                              <label for="inventory-cron-enabled">Ajustes de inventario <span class="tip" data-tip="Activa/desactiva el cron que revisa ajustes de inventario en Alegra y actualiza Shopify automáticamente.">?</span></label>
				                              <input type="checkbox" id="inventory-cron-enabled" class="toggle" />
				                            </div>
				                            <div class="mode-toggle">
				                              <label for="inventory-cron-interval-select">Cada cuánto consultar</label>
				                              <select id="inventory-cron-interval-select" data-depends-on="inventory-cron-enabled">
			                                <option value="5">Cada 5 minutos</option>
			                                <option value="10">Cada 10 minutos</option>
			                                <option value="15">Cada 15 minutos</option>
			                              </select>
				                            </div>
				                            <div class="mode-toggle">
				                              <label for="cfg-inventory-warehouses">Bodegas para stock</label>
				                              <details class="multi-select">
			                                <summary>
			                                  <span>Seleccionar bodegas</span>
			                                  <em id="cfg-inventory-warehouses-summary">Todas</em>
			                                </summary>
			                                <div class="checkbox-grid single" id="cfg-inventory-warehouses"></div>
			                              </details>
				                            </div>
			                            <div class="mode-toggle">
			                              <label for="rules-sync-enabled">Sincronizar inventario en Shopify <span class="tip" data-tip="Si lo apagas, el sistema no actualizará existencias en Shopify (ni en masivo ni en automático).">?</span></label>
			                              <input type="checkbox" id="rules-sync-enabled" class="toggle" />
			                            </div>
			                          </div>
			                          <div class="mode-actions" aria-label="Estado de automatización">
			                            <span class="kpi-sub">
			                              <span class="status-led" id="inventory-cron-led"></span>
			                              <strong>Estado:</strong> <span id="inventory-cron-status">Sin datos</span>
			                            </span>
			                            <span class="kpi-sub"><strong>Última actualización:</strong> <span id="inventory-cron-checkpoint">-</span></span>
			                            <span class="kpi-sub"><strong>Intervalo actual:</strong> <span id="inventory-cron-interval">-</span></span>
			                          </div>
			                        </div>
			                      </div>
		                      <div class="module-footer">
		                        <button class="ghost module-action" data-module-edit="alegra-inventory" type="button">Editar</button>
		                        <button class="primary module-action" data-module-save="alegra-inventory" type="button">Guardar</button>
		                      </div>
		                      <p class="field-hint module-warning is-hidden" data-module-warning="alegra-inventory"></p>
		                    </div>
		                  </div>

		                </div>
		              </div>
		              <div class="settings-group provider-group" data-group="contacts">
	                <div class="settings-group-header" data-group-toggle="contacts">
	                  <h4 class="group-title">
	                    <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
	                    <span class="group-arrow">↔</span>
	                    <img class="provider-logo" src="/brands/alegra.png?v=20260201s" alt="Alegra" />
	                    Contactos
	                  </h4>
	                </div>
	                <div class="settings-group-body">
		                  <div class="panel admin-only module" data-provider="bridge" data-manager="shopify" data-module="sync-contacts" data-module-priority="core" data-help="Modulo principal de Contactos: define como se identifican y sincronizan clientes entre Shopify y Alegra. Incluye modos automatico (se sincroniza solo), masivo e individual (manual).">
	                    <div class="panel-header">
	                      <h3 data-module-toggle="sync-contacts" data-title-base="Contactos bidireccionales">
	                        Contactos bidireccionales
	                        <span class="tip" data-tip="Configura sincronizacion masiva, automatica y manual (1 contacto) entre Shopify y Alegra.">?</span>
	                      </h3>
	                      <div class="panel-meta">
	                        <span class="panel-tag tag-core">Core</span>
	                        <span class="panel-tag tag-bridge">Alegra ↔ Shopify</span>
	                      </div>
	                    </div>
	                    <div class="module-body">
		                      <div class="mode-sections">
		                        <div class="mode-section" data-readonly-free="1">
		                          <div class="mode-head">
		                            <h4>Sincronizacion masiva (inicio)</h4>
		                            <span class="tip" data-tip="Usala para crear/normalizar la base de contactos. Elige la dirección, un rango de fechas y si quieres crear contactos nuevos en el destino.">?</span>
		                          </div>
		                          <div class="mode-grid">
		                            <div class="mode-field">
		                              <label for="sync-contacts-bulk-direction">De dónde a dónde</label>
		                              <select id="sync-contacts-bulk-direction">
		                                <option value="shopify_to_alegra">Shopify → Alegra</option>
		                                <option value="alegra_to_shopify">Alegra → Shopify</option>
		                              </select>
		                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contacts-bulk-date-start">Fecha inicio</label>
		                              <input type="date" id="sync-contacts-bulk-date-start" />
		                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contacts-bulk-date-end">Fecha fin</label>
		                              <input type="date" id="sync-contacts-bulk-date-end" />
		                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contact-limit">Limite (opcional)</label>
		                              <input type="number" id="sync-contact-limit" min="1" placeholder="200" />
		                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contacts-bulk-create" id="sync-contacts-bulk-create-label">Crear contacto en destino <span class="tip" data-tip="Si está activo y el contacto no existe en el destino, lo creamos. Si lo apagas, solo actualizamos contactos ya existentes (mapeados o encontrados).">?</span></label>
		                              <input type="checkbox" id="sync-contacts-bulk-create" class="toggle" checked />
		                            </div>
		                            <div class="mode-actions">
		                              <button class="primary" id="sync-contacts-bulk-run" type="button">Sincronizar masivo</button>
		                              <button class="ghost danger" id="sync-contacts-bulk-stop" type="button" hidden>Detener</button>
		                              <button class="ghost" id="sync-contacts-bulk-clear" type="button">Limpiar</button>
		                              <span class="kpi-sub" id="sync-contacts-status">Sin datos</span>
		                            </div>
		                          </div>
		                        </div>

		                        <div class="mode-section">
		                          <div class="mode-head">
		                            <h4>Sincronizacion automatica y manual</h4>
		                            <span class="tip" data-tip="Define qué direcciones están activas y si se permiten creaciones nuevas en el destino.">?</span>
		                          </div>
		                          <div class="mode-grid">
		                            <div class="mode-field">
		                              <label for="sync-contacts-shopify">Shopify → Alegra <span class="tip" data-tip="Si está activo, puedes sincronizar contactos desde Shopify hacia Alegra (manual y masivo).">?</span></label>
		                              <input type="checkbox" id="sync-contacts-shopify" class="toggle" checked />
		                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contacts-create-alegra">Crear en Alegra <span class="tip" data-tip="Si está activo y el contacto no existe en Alegra, lo creamos. Si lo apagas, solo actualizamos contactos ya existentes.">?</span></label>
		                              <input type="checkbox" id="sync-contacts-create-alegra" class="toggle" data-depends-on="sync-contacts-shopify" checked />
		                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contacts-alegra">Alegra → Shopify <span class="tip" data-tip="Si está activo, puedes sincronizar contactos desde Alegra hacia Shopify (manual y masivo).">?</span></label>
		                              <input type="checkbox" id="sync-contacts-alegra" class="toggle" checked />
		                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contacts-create-shopify">Crear en Shopify <span class="tip" data-tip="Si está activo y el contacto no existe en Shopify, lo creamos. Si lo apagas, solo actualizamos contactos ya existentes.">?</span></label>
		                              <input type="checkbox" id="sync-contacts-create-shopify" class="toggle" data-depends-on="sync-contacts-alegra" checked />
		                            </div>
		                            <div class="mode-field">
		                              <label for="sync-contacts-priority">Prioridad de identificacion</label>
		                              <select id="sync-contacts-priority">
		                                <option value="document_phone_email">Documento → Teléfono → Email</option>
		                                <option value="email_document_phone">Email → Documento → Teléfono</option>
		                                <option value="phone_document_email">Teléfono → Documento → Email</option>
		                              </select>
		                            </div>
		                          </div>
		                        </div>
		                      </div>
		                      <div class="module-footer">
		                        <button class="ghost module-action" data-module-edit="sync-contacts" type="button">Editar</button>
		                        <button class="primary module-action" data-module-save="sync-contacts" type="button">
		                          Guardar
		                          <span class="tip" data-tip="Guarda estas reglas para la tienda activa. Para validar y buscar contactos sincronizados, usa el módulo Contactos.">?</span>
		                        </button>
		                      </div>
		                      <p class="field-hint module-warning is-hidden" data-module-warning="sync-contacts"></p>
		                    </div>
		                  </div>
	                </div>
	              </div>

	              <div class="settings-group provider-group" data-group="orders">
	                <div class="settings-group-header" data-group-toggle="orders">
	                  <h4 class="group-title">
	                    <img class="provider-logo" src="/brands/shopify.png?v=20260201s" alt="Shopify" />
	                    <span class="group-arrow">↔</span>
	                    <img class="provider-logo" src="/brands/alegra.png?v=20260201s" alt="Alegra" />
	                    Pedidos y facturacion
	                  </h4>
	                </div>
	                <div class="settings-group-body">
	                  <div class="panel admin-only module" data-provider="bridge" data-manager="shopify" data-module="sync-orders" data-module-priority="core" data-help="Modulo principal de Pedidos: define como se sincronizan pedidos entre Shopify y Alegra. Incluye automatico (se sincroniza solo), masivo (inicio) y acciones manuales por pedido.">
	                    <div class="panel-header">
	                      <h3 data-module-toggle="sync-orders" data-title-base="Pedidos y facturas">
	                        Pedidos y facturas
                        <span class="tip" data-tip="Modulo principal de Pedidos: reglas para automatico, masivo y manual.">?</span>
                      </h3>
                      <div class="panel-meta">
                        <span class="panel-tag tag-core">Core</span>
                        <span class="panel-tag tag-bridge">Shopify ↔ Alegra</span>
                      </div>
                    </div>
                    <div class="module-body">
                      <div class="mode-sections">
                        <div class="mode-section">
                          <div class="mode-head">
                            <h4>Sincronizacion automatica (pedidos nuevos)</h4>
                            <span class="tip" data-tip="Se ejecuta cuando llega un pedido nuevo desde Shopify.">?</span>
                          </div>
                          <div class="mode-grid">
                            <div class="mode-field">
                              <label for="sync-orders-shopify-enabled">Procesar pedidos nuevos</label>
                              <input type="checkbox" id="sync-orders-shopify-enabled" class="toggle" />
                            </div>
                            <div class="mode-field">
                              <label for="sync-orders-shopify">Que crear en Alegra <span class="tip" data-tip="Registrar, crear contacto o crear factura.">?</span></label>
                              <select id="sync-orders-shopify" data-depends-on="sync-orders-shopify-enabled">
                                <option value="db_only">Solo registrar</option>
                                <option value="contact_only">Crear contacto</option>
                                <option value="invoice">Crear factura</option>
                                <option value="off">No sincronizar</option>
                              </select>
                            </div>
                          </div>
                        </div>

	                        <div class="mode-section">
	                          <div class="mode-head">
	                            <h4>Sincronizacion automatica (facturas nuevas)</h4>
	                            <span class="tip" data-tip="Se ejecuta cuando llega una factura nueva desde Alegra.">?</span>
	                          </div>
                          <div class="mode-grid">
                            <div class="mode-field">
                              <label for="sync-orders-alegra-enabled">Procesar facturas nuevas</label>
                              <input type="checkbox" id="sync-orders-alegra-enabled" class="toggle" />
                            </div>
                            <div class="mode-field">
                              <label for="sync-orders-alegra">Como crear pedido en Shopify <span class="tip" data-tip="Borrador crea el pedido sin publicar; Activo lo crea listo para gestionar.">?</span></label>
                              <select id="sync-orders-alegra" data-depends-on="sync-orders-alegra-enabled">
                                <option value="draft">Crear pedido borrador</option>
                                <option value="active">Crear pedido activo</option>
                                <option value="off">No sincronizar</option>
                              </select>
	                            </div>
	                          </div>
	                        </div>
	                      </div>
	                      <div class="mode-section">
	                        <div class="mode-head">
	                          <h4>Automatizacion en tiempo real (Shopify)</h4>
	                          <span class="tip" data-tip="Activalo para que pedidos, inventario y productos se sincronicen solos. Si cambias el dominio de la tienda, vuelve a activarlo.">?</span>
	                        </div>
	                        <div class="settings-grid">
	                          <div class="field span-2">
		                          <p class="field-hint">Activa la automatizacion para que el sistema procese cambios automaticamente.</p>
	                          </div>
	                        </div>
	                        <div class="toolbar is-actions">
		                        <button class="primary" id="shopify-webhooks-create" type="button">Activar automatizacion</button>
		                        <button class="ghost danger" id="shopify-webhooks-delete" type="button">Desactivar automatizacion</button>
		                        <button class="ghost info" id="shopify-webhooks-status-btn" type="button">Ver estado</button>
		                        <span class="kpi-sub" id="shopify-webhooks-status">Sin configurar</span>
	                        </div>
		                      </div>
	                      <div class="module-footer">
	                        <button class="ghost module-action" data-module-edit="sync-orders" type="button">Editar</button>
	                        <button class="primary module-action" data-module-save="sync-orders" type="button">Guardar</button>
	                      </div>
                      <p class="field-hint module-warning is-hidden" data-module-warning="sync-orders"></p>
                    </div>
                  </div>

                  <div class="panel admin-only module" data-provider="alegra" data-manager="shopify" data-module="alegra-logistics" id="inventory-transfer-panel" data-help="Configura bodegas y traslados automaticos (si se requieren) para pedidos Shopify → Alegra.">
            <div class="panel-header">
              <h3 data-module-toggle="alegra-logistics" data-title-base="Logistica e inventario">Logistica e inventario</h3>
              <span class="panel-tag tag-alegra">Alegra</span>
            </div>
            <div class="module-body">
              <div class="settings-grid products-settings">
                <div class="field field-span">
                  <span class="kpi-sub">Reglas de bodega</span>
                </div>
                <div class="field field-span">
                  <p class="field-hint">Aplica para traslados y facturacion.</p>
                </div>
                <div class="field field-span">
                  <span class="kpi-sub">Secuencia de decision</span>
                </div>
                <div class="field">
	                  <label>Estrategia principal</label>
	                  <select id="cfg-transfer-strategy" data-depends-on="cfg-transfer-enabled">
	                    <option value="manual">Manual (sin estrategia)</option>
	                    <option value="consolidation">Consolidacion</option>
	                    <option value="priority">Prioridad</option>
	                    <option value="max_stock">Mayor existencia</option>
	                  </select>
                </div>
                <div class="field">
	                  <label>Estrategia de respaldo</label>
	                  <select id="cfg-transfer-fallback" data-depends-on="cfg-transfer-enabled">
	                    <option value="">Ninguna</option>
	                    <option value="manual">Manual (sin estrategia)</option>
	                    <option value="consolidation">Consolidacion</option>
	                    <option value="priority">Prioridad</option>
	                    <option value="max_stock">Mayor existencia</option>
	                  </select>
                </div>
                <div class="field">
	                  <label>Desempate</label>
	                  <select id="cfg-transfer-tiebreak" data-depends-on="cfg-transfer-enabled">
	                    <option value="">Ninguno</option>
	                    <option value="max_stock">Mayor existencia</option>
	                    <option value="priority">Prioridad</option>
	                    <option value="random">Aleatorio</option>
	                  </select>
                </div>
	                <div class="field is-toggle">
	                  <label>Permitir dividir pedido</label>
	                  <input type="checkbox" id="cfg-transfer-split" class="toggle" data-depends-on="cfg-transfer-enabled" />
		            </div>
                <div class="field field-span">
                  <span class="kpi-sub">Bodegas elegibles</span>
                </div>
                <div class="field">
	                  <label>Bodega prioritaria</label>
	                  <select id="cfg-transfer-priority" data-depends-on="cfg-transfer-enabled"></select>
	                </div>
	                <div class="field span-2" id="cfg-transfer-origin-field" data-depends-on="cfg-transfer-enabled">
	                  <label>Bodegas origen</label>
	                  <details class="multi-select">
                    <summary>
                      <span>Seleccionar bodegas</span>
                      <em id="cfg-transfer-origin-summary">Todas</em>
                    </summary>
                    <div class="checkbox-grid single" id="cfg-transfer-origin"></div>
                  </details>
                </div>
                <div class="field">
	                  <label>Stock minimo por bodega</label>
	                  <input type="number" id="cfg-transfer-min-stock" data-depends-on="cfg-transfer-enabled" min="0" step="1" placeholder="0" />
	                </div>
                <div class="field field-span">
                  <span class="kpi-sub">Traslados de inventario</span>
                </div>
                <div class="field">
	                  <label>Destino</label>
	                  <select id="cfg-transfer-dest" data-depends-on="cfg-transfer-enabled"></select>
	                </div>
	                <div class="field is-toggle">
	                  <label>Traslado automatico</label>
	                  <input type="checkbox" id="cfg-transfer-enabled" class="toggle" />
	                </div>
              </div>
              <div class="module-footer">
                <button class="ghost module-action" data-module-edit="alegra-logistics" type="button">Editar</button>
                <button class="primary module-action" data-module-save="alegra-logistics" type="button">Guardar</button>
              </div>
              <p class="field-hint module-warning is-hidden" data-module-warning="alegra-logistics"></p>
            </div>
          </div>

                  <div class="panel admin-only module" data-provider="alegra" data-manager="shopify" data-module="alegra-invoice" id="legacy-invoice-panel" data-help="Se usa cuando Shopify → Alegra = Factura. Define listas de precios y parametros de facturacion.">
            <div class="panel-header">
              <h3 data-module-toggle="alegra-invoice" data-title-base="Facturacion">Facturacion</h3>
              <span class="panel-tag tag-alegra">Alegra</span>
            </div>
            <div class="module-body">
              <div class="settings-grid">
                <div class="field field-span">
                  <span class="kpi-sub">Listas de precios</span>
                </div>
	                <div class="field is-toggle">
	                  <label>Usar listas de precios</label>
	                  <input type="checkbox" id="cfg-price-enabled" class="toggle" />
	                </div>
                <div class="field field-span">
                  <p class="field-hint">Opcional. Si queda vacio, se usa el precio base de Alegra.</p>
                </div>
                <div class="field">
	                  <label>Lista para precio base</label>
	                  <select id="cfg-price-general" data-depends-on="cfg-price-enabled" data-allow-empty="true" data-empty-label="Usar precio base de Alegra"></select>
	                </div>
	                <div class="field">
	                  <label>Lista para descuentos</label>
	                  <select id="cfg-price-discount" data-depends-on="cfg-price-enabled" data-allow-empty="true" data-empty-label="No aplicar descuento"></select>
	                </div>
	                <div class="field">
	                  <label>Lista para mayoristas</label>
	                  <select id="cfg-price-wholesale" data-depends-on="cfg-price-enabled" data-allow-empty="true" data-empty-label="No aplicar mayorista"></select>
	                </div>
	                <div class="field">
	                  <label>Moneda</label>
	                  <select id="cfg-price-currency" data-depends-on="cfg-price-enabled">
	                    <option value="">Auto</option>
	                    <option value="COP">COP</option>
	                    <option value="USD">USD</option>
	                  </select>
	                </div>
	                <div class="field is-toggle">
	                  <label>Facturar automaticamente</label>
	                  <input type="checkbox" id="cfg-generate-invoice" class="toggle" />
	                </div>
	                <div class="field is-toggle">
	                  <label>Habilitar factura electronica</label>
		                  <input type="checkbox" id="cfg-einvoice-enabled" class="toggle" data-depends-on="cfg-generate-invoice" />
		                </div>
                <div class="field">
	                  <label>Resolucion DIAN</label>
	                  <select id="cfg-resolution" data-depends-on="cfg-generate-invoice"></select>
	                </div>
	                <div class="field">
	                  <label>Centro de costos</label>
	                  <select id="cfg-cost-center" data-depends-on="cfg-generate-invoice"></select>
	                </div>
	                <div class="field">
	                  <label>Bodega</label>
	                  <select id="cfg-warehouse" data-depends-on="cfg-generate-invoice"></select>
	                </div>
	                <div class="field">
	                  <label>Vendedor</label>
	                  <select id="cfg-seller" data-depends-on="cfg-generate-invoice"></select>
	                </div>
	                <div class="field">
	                  <label>Metodo de pago</label>
	                  <select id="cfg-payment-method" data-depends-on="cfg-generate-invoice" data-allow-empty="true" data-empty-label="No aplicar"></select>
	                </div>
	                <div class="field">
	                  <label>Cuenta bancaria</label>
	                  <select id="cfg-bank-account" data-depends-on="cfg-generate-invoice,cfg-apply-payment" data-allow-empty="true" data-empty-label="No aplicar"></select>
	                </div>
                <div class="field field-span">
                  <p class="field-hint">Si aparecen "Sin datos", crea metodos de pago y cuentas en Alegra.</p>
                </div>
	                <div class="field is-toggle">
	                  <label>Aplicar pago</label>
		                  <input type="checkbox" id="cfg-apply-payment" class="toggle" data-depends-on="cfg-generate-invoice" />
		                </div>
	                <div class="field">
	                  <label>Observaciones</label>
	                  <input type="text" id="cfg-observations" data-depends-on="cfg-generate-invoice" placeholder="Pedido {{order.name}}" />
	                </div>
                <div class="field field-span">
                  <p class="field-hint" id="cfg-store-message"></p>
                </div>
              </div>
              <div class="module-footer">
                <button class="ghost module-action" data-module-edit="alegra-invoice" type="button">Editar</button>
                <button class="primary module-action" data-module-save="alegra-invoice" type="button">Guardar</button>
              </div>
              <p class="field-hint module-warning is-hidden" data-module-warning="alegra-invoice"></p>
            </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        </section>
      </main>
    </div>

    <button class="assistant-launch" id="assistant-launch" type="button">Asistente</button>
    <div class="assistant-drawer" id="assistant-drawer" aria-hidden="true">
      <div class="panel assistant-panel">
        <div class="panel-header assistant-header">
          <div class="assistant-header-title">
            <div class="assistant-avatar-wrap">
              <img src="/assets/logo.png" alt="Apiflujos" class="assistant-avatar-badge" />
              <img src="/assets/avatar.png" alt="Olivia IA" class="assistant-avatar" />
            </div>
            <div class="assistant-title">
              <h3>Asistente IA</h3>
              <span class="assistant-byline">By apiflujos</span>
            </div>
          </div>
          <div class="assistant-header-actions">
            <span class="panel-tag">Olivia</span>
            <button class="ghost" id="assistant-close" type="button">Cerrar</button>
          </div>
        </div>
        <div class="assistant-messages" id="assistant-messages"></div>
        <div class="assistant-controls">
          <span class="assistant-hint">Enter para enviar · Ctrl+Enter para salto de linea</span>
        </div>
        <div class="assistant-input">
          <div class="assistant-attachments" id="assistant-attachments"></div>
          <div class="assistant-composer">
            <label class="ghost assistant-attach" id="assistant-attach" for="assistant-file" title="Adjuntar archivo">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M7 12l6-6a4 4 0 1 1 6 6l-8 8a6 6 0 0 1-8-8l9-9" />
              </svg>
            </label>
            <textarea id="assistant-input" rows="2" placeholder="Escribe una instruccion para Olivia IA..."></textarea>
            <button class="primary assistant-send" id="assistant-send" type="button" title="Enviar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M4 12l16-8-6 8 6 8-16-8z" />
              </svg>
            </button>
          </div>
          <input id="assistant-file" type="file" multiple accept="image/*,application/pdf" />
        </div>
      </div>
    </div>

    <div class="modal" id="payload-modal" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Detalle de payload</h4>
          <button id="modal-close">Cerrar</button>
        </div>
        <pre id="modal-body">Sin datos</pre>
      </div>
    </div>

    <div class="modal" id="einvoice-modal" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h4>Factura electronica</h4>
            <p class="kpi-sub" id="einvoice-order">Pedido: -</p>
          </div>
          <button id="einvoice-close">Cerrar</button>
        </div>
        <div class="settings-grid modal-form">
          <div class="field">
            <label>Facturar electronicamente</label>
            <input type="checkbox" id="einvoice-flag" />
          </div>
          <div class="field">
            <label>Nombre fiscal</label>
            <input type="text" id="einvoice-name" placeholder="Nombre o razon social" />
          </div>
          <div class="field">
            <label>Tipo de documento</label>
            <select id="einvoice-id-type">
              <option value="">Seleccionar</option>
              <option value="CC">CC</option>
              <option value="NIT">NIT</option>
              <option value="CE">CE</option>
              <option value="TI">TI</option>
              <option value="PP">Pasaporte</option>
              <option value="OTRO">Otro</option>
            </select>
          </div>
          <div class="field">
            <label>Numero de documento</label>
            <input type="text" id="einvoice-id-number" placeholder="Documento" />
          </div>
          <div class="field">
            <label>Email</label>
            <input type="email" id="einvoice-email" placeholder="correo@cliente.com" />
          </div>
          <div class="field">
            <label>Telefono</label>
            <input type="text" id="einvoice-phone" placeholder="Telefono" />
          </div>
          <div class="field">
            <label>Direccion</label>
            <input type="text" id="einvoice-address" placeholder="Calle 123 # 4-56" />
          </div>
          <div class="field">
            <label>Ciudad</label>
            <input type="text" id="einvoice-city" placeholder="Ciudad" />
          </div>
          <div class="field">
            <label>Departamento</label>
            <input type="text" id="einvoice-state" placeholder="Departamento" />
          </div>
          <div class="field">
            <label>Pais</label>
            <input type="text" id="einvoice-country" placeholder="Colombia" />
          </div>
          <div class="field">
            <label>Codigo postal</label>
            <input type="text" id="einvoice-zip" placeholder="Codigo postal" />
          </div>
        </div>
        <div class="toolbar">
          <button class="primary" id="einvoice-save" type="button">Guardar</button>
          <span class="kpi-sub" id="einvoice-status">-</span>
        </div>
      </div>
    </div>

    <script src="app.js?v=20260204p16" type="module"></script>
  </body>
</html>
